<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,maximum-scale=1.0,minimum-scale=1.0" name="viewport">
<title>wolfie.life</title>

<link rel="modulepreload" href="https://esm.sh/react@18.3.1">
<link rel="modulepreload" href="https://esm.sh/react-dom@18.3.1/client">
<link rel="modulepreload" href="https://esm.sh/three@0.160.1">
<link rel="modulepreload" href="https://esm.sh/@react-three/fiber@8.16.0?deps=react@18.3.1,react-dom@18.3.1,three@0.160.1">
<link rel="modulepreload" href="https://esm.sh/gsap@3.12.5">

<link href="https://fonts.googleapis.com" rel="preconnect" crossorigin>
<link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
  /* ===================================
     CSS VARIABLES — wolfie.love palette
     =================================== */
  :root {
      /* ── Palette ── */
      --bg-color: #000000;
      --ink: #ffffff;
      --ink-2: #b8b8b8;
      --ink-3: #808080;
      --accent: #daa520;
      --danger: #ff6363;

      /* ── Semantic surfaces ── */
      --surface: rgba(0, 0, 0, 0.60);
      --surface-raised: rgba(10, 10, 10, 0.95);
      --border: rgba(255, 255, 255, 0.10);
      --border-strong: rgba(255, 255, 255, 0.15);
      --border-color: rgba(255, 255, 255, 0.10); /* alias */
      --hover-tint: rgba(218, 165, 32, 0.08);
      --hover-tint-strong: rgba(218, 165, 32, 0.15);

      --glass-bg: var(--surface);
      --glass-bg-hover: var(--hover-tint);
      --glass-border: var(--border);

      /* ── Typography ── */
      --ui-font: 'Space Mono', monospace;
      --body-font: 'Crimson Text', Georgia, serif;

      /* ── Effects ── */
      --curve-k: 1;
      --vig-opacity: 0.85;
      --vig-inner: 30%;
      --vig-mid: 75%;
      --vig-outer: 100%;
      --edge-blur: 6px;
      --edge-mask-i: 65%;
      --edge-mask-o: 80%;
      --grain-opacity: 0.08;

      /* ── Selection ── */
      --selection-bg: rgba(218, 165, 32, 0.25);
      --selection-color: #ffffff;

      /* ── Cursor ── */
      --cursor-size: 20px;
      --cursor-bg: transparent;
      --cursor-border: rgba(255, 255, 255, 0.50);
      --cursor-blend: difference;

      /* ── Layout ── */
      --fab-size: 120px;
      --fab-bottom: calc(env(safe-area-inset-bottom) + clamp(16px, 3vh, 32px));
      --corner-pad: clamp(14px, 2.4vw, 24px);
      --corner-top: calc(env(safe-area-inset-top) + clamp(12px, 2vh, 18px));

      /* ── z-index stack ── */
      --z-content: 0;
      --z-background: 1;
      --z-grain: 149;
      --z-blur: 150;
      --z-vig: 151;
      --z-ui: 220;
      --z-overlay: 250;
      --z-cursor: 230;

      /* ── Tokens ── */
      --border-width: 1px;
      --border-radius-sm: 3px;
      --border-radius-md: 6px;
      --border-radius-lg: 8px;

      /* ── Morphing disclosure ── */
      --duration: 0.26s;
      --ease: linear(0 0%, 0.2688 9.91%, 0.3859 15%, 0.9929 80.76%, 0.9986 88.89%, 1 100%);
      --blur: 4;
      --translate-y: 1;
      --opacity: 0.4;
      --translate-margin: 1.5;
      --dim: 0.4;
  }

  /* ===================================
     RESET & BASE
     =================================== */
  *, *::before, *::after { box-sizing: border-box; }
  html { color-scheme: dark; -webkit-text-size-adjust: 100%; }
  body, html, #root { height: 100%; margin: 0; }
  body {
      background: var(--bg-color);
      color: var(--ink);
      font: 18px/1.6 var(--body-font);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      cursor: none;
      transition: background-color 0.35s ease, color 0.35s ease;
  }
  body::-webkit-scrollbar { display: none; }
  body { -ms-overflow-style: none; scrollbar-width: none; }
  ::selection { background: var(--selection-bg); color: var(--selection-color); }

  @media (min-height: 900px) {
      .dark-layer { background-size: 100% 105%; transform: translateY(-2vh); }
  }

  /* ===================================
     VISUAL EFFECTS
     =================================== */
  .edge-blur {
      position: fixed; inset: 0; pointer-events: none; z-index: var(--z-blur);
      backdrop-filter: blur(var(--edge-blur)); -webkit-backdrop-filter: blur(var(--edge-blur));
      mask: radial-gradient(100% 64% at 50% 50%, transparent var(--edge-mask-i), rgb(255 255 255 / 0.98) var(--edge-mask-o));
      -webkit-mask: radial-gradient(100% 64% at 50% 50%, transparent var(--edge-mask-i), rgb(255 255 255 / 0.98) var(--edge-mask-o));
      will-change: transform; transform: translateZ(0);
  }
  .vignette {
      position: fixed; inset: 0; pointer-events: none; z-index: var(--z-vig);
      background: radial-gradient(120% 90% at 50% 50%, #fff0 var(--vig-inner), rgb(0 0 0 / 0.55) var(--vig-mid), rgb(0 0 0 / 0.9) var(--vig-outer));
      opacity: calc(var(--vig-opacity) * var(--curve-k));
      will-change: opacity; transform: translateZ(0);
      transition: opacity 0.35s ease;
  }
  body::after {
      content: ""; position: fixed; inset: 0; pointer-events: none;
      z-index: var(--z-grain); opacity: var(--grain-opacity);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.45'/%3E%3C/svg%3E");
      background-size: 120px 120px; will-change: transform; transform: translateZ(0);
  }

  @media (prefers-reduced-motion: reduce) {
      .edge-blur { backdrop-filter: none; -webkit-backdrop-filter: none; }
      *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
      .curved { transform: none; }
  }

  /* ===================================
     3D CANVAS
     =================================== */
  .canvas-wrap { position: absolute; inset: 0; z-index: var(--z-content); }
  .canvas-wrap canvas {
      touch-action: none; cursor: grab; background: #000; width: 100%; height: 100%;
      -webkit-touch-callout: none; -webkit-user-select: none; user-select: none;
      -webkit-tap-highlight-color: transparent; touch-action: manipulation;
  }
  .canvas-wrap canvas.dragging { cursor: grabbing; }

  .fallback-grid {
      position: absolute; inset: 0; z-index: var(--z-content); pointer-events: none;
      opacity: 0.06;
      background-image: repeating-linear-gradient(to right, #fff 0 1px, transparent 1px 48px),
                        repeating-linear-gradient(to bottom, #fff 0 1px, transparent 1px 48px);
  }

  .curved {
      transform-style: preserve-3d;
      transform: perspective(1000px) translateZ(calc(-200px * var(--curve-k))) scale(calc(1 + var(--curve-k) * 0.06));
      will-change: transform;
  }

  /* ===================================
     HEADER
     =================================== */
  .header {
      position: fixed; inset: 0 0 auto 0;
      z-index: calc(var(--z-ui) + 1);
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; padding: var(--corner-top) var(--corner-pad) 12px;
      pointer-events: none;
  }

  .brand {
      display: flex; align-items: center; gap: 7px;
      text-decoration: none; user-select: none; pointer-events: auto;
      padding: 5px 9px; border-radius: var(--border-radius-sm);
      background: var(--surface); border: 1px solid var(--border);
      font-family: var(--ui-font); font-size: 10px; letter-spacing: 0.1em;
      text-transform: uppercase; color: var(--ink-3);
      transition: background 0.25s ease, border-color 0.25s ease, color 0.25s ease;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  }
  .brand:hover { background: var(--hover-tint); color: var(--ink); border-color: var(--accent); }
  .brand:active { transform: scale(0.95); }
  .brand img {
      display: block; height: 24px; width: auto;
      filter: grayscale(1) brightness(2); transition: filter 0.2s ease;
  }
  .brand:hover img { filter: none; }

  .controls { display: flex; gap: 6px; align-items: center; pointer-events: auto; }

  /* ===================================
     ICON BUTTON
     =================================== */
  .icon-btn {
      appearance: none; cursor: pointer;
      border: 1px solid var(--border); background: var(--surface);
      color: var(--ink-3); padding: 8px; border-radius: var(--border-radius-md);
      display: inline-flex; align-items: center; justify-content: center;
      transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease, transform 0.15s ease;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  }
  .icon-btn:hover { background: var(--hover-tint); border-color: var(--accent); color: var(--accent); transform: scale(1.08); }
  .icon-btn:active { transform: scale(0.94); }
  .icon-btn svg { display: block; width: 14px; height: 14px; }

  /* ===================================
     BUTTON
     =================================== */
  .btn {
      appearance: none; cursor: pointer;
      border: 1px solid var(--border); background: var(--surface);
      color: var(--ink-3); padding: 8px 14px; border-radius: var(--border-radius-md);
      font-family: var(--ui-font); font-size: 10px; letter-spacing: 0.08em;
      text-transform: uppercase; font-weight: 400;
      transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease, transform 0.15s ease;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  }
  .btn:hover { background: var(--hover-tint); border-color: var(--accent); color: var(--accent); }
  .btn:active { transform: scale(0.96); }
  .btn.ghost { background: #fff0; }
  .btn.primary {
      border-color: var(--accent); background: var(--accent);
      color: #0b0b0d; font-weight: 700;
  }
  .btn.primary:hover { background: color-mix(in srgb, var(--accent) 90%, white); color: #000; }
  .btn-delete { background: var(--danger); border-color: var(--danger); color: #ffffff; }

  /* ===================================
     SIDE RAILS — VIEW TOGGLE & ZOOM PRESETS
     =================================== */
  .view-toggle, .zoom-presets {
      position: fixed; top: 50%; transform: translateY(-50%); z-index: var(--z-ui);
      display: flex; flex-direction: column; gap: 4px;
      background: var(--surface); border-radius: var(--border-radius-md);
      padding: 6px; border: 1px solid var(--border);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 2px 12px rgba(0,0,0,0.3);
      transition: background 0.35s ease, border-color 0.35s ease;
  }
  .view-toggle { left: var(--corner-pad); }
  .zoom-presets { right: var(--corner-pad); }

  .toggle-btn, .zoom-presets-btn {
      appearance: none; border: 1px solid transparent; background: transparent;
      color: var(--ink-3); padding: 8px; cursor: pointer;
      border-radius: var(--border-radius-sm);
      font-family: var(--ui-font); font-weight: 400; font-size: 10px;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;
  }
  .toggle-btn svg { width: 16px; height: 16px; display: block; }
  .toggle-btn:hover, .zoom-presets-btn:hover { color: var(--accent); background: var(--hover-tint); }
  .toggle-btn.active, .zoom-presets-btn.active {
      color: var(--accent); background: var(--hover-tint-strong);
      border-color: color-mix(in srgb, var(--accent) 30%, transparent);
  }

  /* ===================================
     OVERLAYS
     =================================== */
  .overlay {
      position: fixed; inset: 0; z-index: var(--z-overlay);
      display: none; pointer-events: auto;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      align-items: center; justify-content: center;
      padding: clamp(16px, 3vw, 32px);
  }
  .overlay.open { display: flex; }
  .overlay.curved { transform: none !important; transform-style: flat !important; perspective: none !important; }

  .overlay-wrapper {
      position: fixed; inset: 0; z-index: var(--z-overlay);
      display: none; flex-direction: column;
      background: rgba(0, 0, 0, 0.88);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  }
  .overlay-wrapper.open { display: flex; }

  /* ===================================
     DELETE CONFIRM DIALOG
     =================================== */
  .delete-confirm-dialog {
      background: var(--surface-raised); border: 1px solid var(--border-strong);
      border-radius: var(--border-radius-lg); padding: clamp(20px, 3vw, 32px);
      max-width: min(90vw, 400px); width: 100%;
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6);
  }
  .delete-confirm-dialog h3 {
      margin: 0 0 12px; font-family: var(--ui-font); font-size: 10px;
      letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--accent); font-weight: 400;
  }
  .delete-confirm-dialog p {
      margin: 0 0 24px; color: var(--ink-2);
      font-family: var(--body-font); font-size: 18px; line-height: 1.55;
  }
  .delete-confirm-buttons { display: flex; gap: 10px; justify-content: flex-end; }

  /* ===================================
     TITLE BARS
     =================================== */
  .title-bar {
      position: sticky; top: 0; z-index: 100;
      padding: clamp(16px, 3vw, 24px) clamp(12px, 2.4vw, 28px);
      background: rgba(0,0,0,0.6); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
  }
  .title-bar h1 {
      margin: 0; font-family: var(--ui-font); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.12em; color: var(--accent); font-weight: 400;
  }

  .close-button {
      appearance: none; background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--border-radius-sm); width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--ink-3); flex-shrink: 0;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.15s ease;
  }
  .close-button:hover { background: var(--hover-tint); border-color: var(--accent); color: var(--accent); }
  .close-button:active { transform: scale(0.95); }

  /* ===================================
     README CONTAINER
     =================================== */
  .container {
      flex: 1; overflow-y: auto; overflow-x: hidden;
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 2rem; padding: clamp(20px, 2.4vw, 32px);
      align-items: start; align-content: start;
  }
  .container::-webkit-scrollbar { width: 4px; }
  .container::-webkit-scrollbar-track { background: transparent; }
  .container::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .container .section { display: flex; flex-direction: column; gap: 1rem; min-width: 0; }
  .section-title {
      font-family: var(--ui-font); font-size: 10px; letter-spacing: 0.12em;
      text-transform: uppercase; font-weight: 400; margin: 0 0 0.5rem; color: var(--ink-3);
  }

  /* ===================================
     MORPHING DISCLOSURE (README accordion)
     =================================== */
  .morphing-disclosure { width: 100%; letter-spacing: -0.01em; line-height: 1.5; }
  .morphing-disclosure:has([open]) details:not([open]) summary { opacity: var(--dim); }

  details {
      background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border);
      border-radius: var(--border-radius-md); cursor: pointer; position: relative;
      transition: margin var(--duration) var(--ease), translate var(--duration) var(--ease),
                  border-radius var(--duration) var(--ease), background var(--duration) var(--ease);
      overflow: hidden; margin-bottom: 0.5rem;
  }
  details:hover { background: var(--hover-tint); }
  details[open] {
      margin-block: calc(var(--translate-margin) * 1rem); z-index: 10;
      background: rgba(255, 255, 255, 0.04);
      border-color: color-mix(in srgb, var(--accent) 30%, transparent);
  }
  details[open]:first-of-type { margin-block-start: 0; }
  details[open]:last-of-type { margin-block-end: 0; }
  details:has(~details[open]) { translate: 0 calc(var(--translate-margin) * -1rem); }
  details[open]~details { translate: 0 calc(var(--translate-margin) * 1rem); }

  summary {
      padding: 0.875rem 1rem; display: grid;
      grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;
      cursor: pointer; list-style: none;
      transition: opacity var(--duration) var(--ease);
      position: relative; z-index: 2; color: var(--ink); user-select: none;
      font-family: var(--ui-font); font-size: 11px;
      text-transform: uppercase; letter-spacing: 0.06em;
  }
  summary::-webkit-details-marker, summary::marker { display: none; }
  summary svg {
      width: 14px; height: 14px; opacity: 0.5;
      transition: transform var(--duration) var(--ease), opacity var(--duration) var(--ease), color 0.2s ease;
      fill: currentColor; flex-shrink: 0;
  }
  details:hover summary svg { color: var(--accent); opacity: 1; }
  details[open] summary svg:last-of-type { transform: rotate(45deg); color: var(--accent); }

  .content {
      padding: 0 1rem 1rem; translate: 0 calc(var(--translate-y) * 1rem);
      opacity: var(--opacity); filter: blur(calc(var(--blur) * 1px));
      color: var(--ink-2);
      transition: translate var(--duration) var(--ease), opacity var(--duration) var(--ease), filter var(--duration) var(--ease);
      position: relative; z-index: 2;
  }
  details[open] .content { translate: 0 0; opacity: 1; filter: blur(0); }
  .content p { margin: 0 0 0.75rem; font-family: var(--body-font); font-size: 18px; line-height: 1.6; }
  .content p:last-child { margin-bottom: 0; }
  .content strong { color: var(--ink); font-weight: 600; }

  kbd {
      background: rgba(255,255,255,0.07); padding: 0.125rem 0.375rem; border-radius: 3px;
      font-size: 0.75rem; font-family: var(--ui-font); border: 1px solid var(--border);
      color: var(--ink); white-space: nowrap;
  }

  /* ===================================
     SHEET (NEW NOTE overlay)
     =================================== */
  .sheet {
      width: min(99vw, 1024px); background: var(--surface-raised);
      border: 1px solid var(--border-strong); border-radius: var(--border-radius-lg);
      padding: clamp(16px, 3vw, 32px); box-shadow: 0 24px 64px rgba(0,0,0,0.6);
      max-height: min(92vh, 92dvh); position: relative; overflow-y: auto;
  }

  .titlebar {
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; padding: 10px 8px; border-bottom: 1px solid var(--border);
      margin: -4px -2px 16px;
  }
  .titlebar h2 {
      margin: 0; font-family: var(--ui-font); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.12em; color: var(--accent); font-weight: 400;
  }

  .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .grid { display: grid; gap: 10px; }
  .cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

  .label {
      font-family: var(--ui-font); font-size: 10px; color: var(--ink-3);
      text-transform: uppercase; letter-spacing: 0.08em; display: block; margin-bottom: 6px;
  }

  .input, .textarea {
      width: 100%; border: 1px solid var(--border); background: rgba(255,255,255,0.04);
      color: var(--ink); border-radius: var(--border-radius-md);
      padding: 10px 14px; font-family: var(--body-font); font-size: 18px;
      transition: border-color 0.2s ease, background 0.2s ease;
      caret-color: var(--accent);
  }
  .input:focus, .textarea:focus {
      outline: none;
      border-color: color-mix(in srgb, var(--accent) 40%, transparent);
      background: rgba(255,255,255,0.06);
  }
  .textarea { min-height: 96px; resize: vertical; line-height: 1.6; }

  .hint { color: var(--ink-3); font-family: var(--ui-font); font-size: 10px; margin-top: 4px; letter-spacing: 0.04em; }

  .preview, .vf {
      position: relative; width: 100%; max-width: 520px;
      aspect-ratio: 1/1; height: auto; margin: 6px auto 0;
      border-radius: var(--border-radius-md); overflow: hidden; border: 1px solid var(--border);
  }
  .vf video { width: 100%; height: 100%; object-fit: cover; filter: grayscale(1) contrast(1.04) brightness(0.98); }
  .preview canvas, .preview img { width: 100%; height: auto; display: block; }
  .preview::before {
      content: "preview • map"; position: absolute; top: 0; left: 0; right: 0; height: 26px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
      font: 400 9px/26px var(--ui-font); padding: 0 10px;
      letter-spacing: 0.1em; text-transform: uppercase; color: var(--accent); z-index: 3;
  }

  /* ===================================
     FAB (New Note button)
     =================================== */
  .fab-wrap {
      position: fixed; left: 50%; bottom: var(--fab-bottom);
      transform: translateX(-50%); z-index: var(--z-ui);
      display: flex; flex-direction: column; align-items: center;
  }
  .fab {
      position: relative; width: var(--fab-size); height: var(--fab-size);
      border-radius: 50%; background: var(--surface); color: var(--ink-3);
      border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;
      cursor: pointer; box-shadow: 0 8px 32px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.3);
      transition: background 0.25s ease, border-color 0.25s ease, color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease;
      pointer-events: auto; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      isolation: isolate;
  }
  .fab:hover {
      background: var(--hover-tint); border-color: var(--accent); color: var(--accent);
      transform: scale(1.05); box-shadow: 0 12px 40px rgba(0,0,0,0.5), 0 0 0 1px color-mix(in srgb, var(--accent) 30%, transparent);
  }
  .fab:active { transform: scale(0.96); }
  .fab svg { width: 58%; height: auto; display: block; }
  .fab-text {
      position: absolute; left: 50%; bottom: 14px; transform: translateX(-50%);
      font: 400 10px/1 var(--ui-font); text-transform: uppercase; letter-spacing: 0.1em;
      color: var(--ink-2); pointer-events: none; transition: color 0.2s ease;
  }
  .fab:hover .fab-text { color: var(--accent); }

  /* ===================================
     HUD (bottom corner labels)
     =================================== */
  .hud {
      position: fixed; bottom: calc(env(safe-area-inset-bottom) + 16px);
      z-index: 2001; pointer-events: auto;
      font: 400 10px/1 var(--ui-font); text-transform: uppercase;
      letter-spacing: 0.08em; color: var(--ink-3); transition: color 0.2s ease;
  }
  .hud-left { left: var(--corner-pad); }
  .hud-left:hover { color: var(--accent); }
  .hud-right { right: var(--corner-pad); pointer-events: none; }

  /* ===================================
     LIST VIEW
     =================================== */
  .listview-root {
      position: fixed; inset: 0; overflow-y: auto; overflow-x: hidden;
      background: var(--bg-color); z-index: 20; height: 100%; display: block;
  }
  .listview-root.curved { transform: scale(1.01); }

  .portfolio-container {
      position: relative; display: flex; flex-direction: column;
      gap: 0; width: 100%; margin: 0 auto;
      padding: 6rem 2rem 8rem 8rem; min-height: 100vh;
      counter-reset: project-counter 0; pointer-events: auto;
  }
  .listview-root .portfolio-container { padding-top: calc(6rem + 120px); padding-bottom: calc(6rem + 120px); }

  .project-list { list-style: none; margin: 0; padding: 0; width: 100%; }

  .project-item {
      cursor: pointer; width: 100%;
      display: grid; grid-template-columns: 40px 1fr 2fr 1fr 1fr 80px;
      grid-column-gap: 2rem; padding: 16px 0; align-items: center;
      border-bottom: 1px solid var(--border);
      transition: opacity 0.3s ease; opacity: 1; position: relative; z-index: 2;
  }
  .project-item.active { opacity: 1; }
  .listview-root.has-active .project-item { opacity: 0.25; }
  .listview-root.has-active .project-item.active { opacity: 1; }

  .project-item::before {
      content: counter(project-counter, decimal-leading-zero); counter-increment: project-counter;
      padding: 4px 0; font-family: var(--ui-font); font-size: 10px;
      color: var(--ink-3); opacity: 0.5; justify-self: start; z-index: 10;
      position: relative; transition: opacity 0.2s ease, color 0.2s ease;
  }
  .project-item:hover::before { color: var(--accent); opacity: 1; }
  .project-item.counter-hidden::before { opacity: 0.05; }

  .project-data {
      position: relative; white-space: nowrap; color: var(--ink-3);
      overflow: hidden; text-overflow: ellipsis; line-height: 1; padding: 2px;
      transition: all 0.3s ease; z-index: 1;
      font-family: var(--ui-font); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.06em;
  }
  .project-data.artist {
      justify-self: start; font-family: var(--body-font); font-size: 24px;
      color: var(--ink); text-transform: none; letter-spacing: normal; font-style: italic;
  }
  .project-data.album, .project-data.category, .project-data.label { justify-self: start; }
  .project-data.year { justify-self: end; text-align: right; }
  .project-data::after {
      content: ""; position: absolute; top: 0; left: -8px;
      width: calc(100% + 16px); height: calc(100% - 2px);
      background: var(--accent); transform: scaleX(0); transform-origin: left;
      transition: transform 0.3s ease; z-index: -1; border-radius: 2px;
  }
  .project-item:hover .project-data::after { transform: scaleX(1); }
  .project-item:hover .project-data { color: #000 !important; }
  .project-item:hover .project-data.artist { font-style: normal; }

  .background-image {
      position: absolute; top: 0; left: 0; width: 1152px; height: 856px;
      background-size: cover; background-position: center; background-repeat: no-repeat;
      opacity: 1; border-radius: var(--border-radius-lg); pointer-events: none;
      transform: translate(-50%, -50%) scale(1);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6); z-index: 0;
      filter: brightness(0.9) contrast(1.05);
      transition: opacity 0.25s ease, transform 0.35s cubic-bezier(0.25, 1, 0.5, 1);
  }

  /* ===================================
     PAGE LOADER — CINEMATIC CAROUSEL
     =================================== */
  #page-loader {
      position: fixed; inset: 0;
      z-index: calc(var(--z-overlay) + 100);
      background: #000;
      pointer-events: auto;
      opacity: 1;
      transition: opacity 0.9s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
  }
  #page-loader.fade-out {
      opacity: 0;
      pointer-events: none;
  }
  #page-loader.hidden {
      display: none;
  }

  /* Carousel slides */
  .pl-slide {
      position: absolute; inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity 0.18s ease;
      transform: scale(1.04);
      transition: opacity 0.18s ease, transform 6s ease;
      will-change: opacity, transform;
  }
  .pl-slide.pl-active {
      opacity: 1;
      transform: scale(1);
  }

  /* Vignette overlay on loader */
  .pl-vignette {
      position: absolute; inset: 0; pointer-events: none; z-index: 2;
      background: radial-gradient(120% 90% at 50% 50%, transparent 25%, rgba(0,0,0,0.5) 70%, rgba(0,0,0,0.92) 100%);
  }

  /* Grain on loader */
  .pl-grain {
      position: absolute; inset: 0; pointer-events: none; z-index: 3; opacity: 0.07;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.45'/%3E%3C/svg%3E");
      background-size: 120px 120px;
  }

  /* Loader UI elements */
  .pl-ui {
      position: absolute; inset: 0; z-index: 4;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-end;
      padding-bottom: clamp(40px, 7vh, 80px);
      pointer-events: none;
  }

  .pl-wordmark {
      font-family: var(--ui-font);
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
      margin-bottom: 28px;
      animation: pl-fade-in 0.6s ease 0.3s both;
  }

  .pl-progress-track {
      width: clamp(80px, 18vw, 160px);
      height: 1px;
      background: rgba(255,255,255,0.12);
      border-radius: 1px;
      overflow: hidden;
      animation: pl-fade-in 0.6s ease 0.5s both;
  }
  .pl-progress-fill {
      height: 100%;
      width: 0%;
      background: var(--accent);
      border-radius: 1px;
      transition: width 0.25s ease;
  }

  /* Title caption */
  .pl-caption {
      position: absolute;
      bottom: clamp(40px, 7vh, 80px);
      left: 0; right: 0;
      text-align: center;
      font-family: var(--body-font);
      font-size: clamp(13px, 1.8vw, 17px);
      font-style: italic;
      color: rgba(255,255,255,0.3);
      letter-spacing: 0.02em;
      z-index: 4;
      padding-bottom: 52px;
      pointer-events: none;
      transition: opacity 0.25s ease;
      animation: pl-fade-in 0.6s ease 0.4s both;
  }

  /* Top corner wordmark */
  .pl-corner {
      position: absolute;
      top: calc(env(safe-area-inset-top) + clamp(12px, 2vh, 18px));
      left: clamp(14px, 2.4vw, 24px);
      z-index: 4;
      font-family: var(--ui-font);
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      animation: pl-fade-in 0.5s ease 0.2s both;
  }
  .pl-corner span { color: var(--accent); }

  /* Slide counter */
  .pl-counter {
      position: absolute;
      top: calc(env(safe-area-inset-top) + clamp(12px, 2vh, 18px));
      right: clamp(14px, 2.4vw, 24px);
      z-index: 4;
      font-family: var(--ui-font);
      font-size: 10px;
      letter-spacing: 0.1em;
      color: rgba(255,255,255,0.25);
      animation: pl-fade-in 0.5s ease 0.2s both;
  }

  @keyframes pl-fade-in {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
  }

  /* Legacy .loader-overlay kept for backward compat, hidden */
  .loader-overlay { display: none !important; }

  /* ===================================
     GOOEY CURSOR
     =================================== */
  #cursor {
      position: fixed;
      top: calc(var(--cursor-size) * -0.5); left: calc(var(--cursor-size) * -0.5);
      pointer-events: none; filter: url(#goo);
      mix-blend-mode: var(--cursor-blend); z-index: var(--z-cursor);
  }
  .cursor-circle {
      position: absolute; top: 0; left: 0;
      width: var(--cursor-size); height: var(--cursor-size);
      border-radius: 50%; background: var(--accent); will-change: transform;
  }
  .goo { display: none; }
  @media (pointer: coarse) { #cursor { display: none; } }

  /* ===================================
     FOCUS VISIBLE
     =================================== */
  :focus { outline: none; }
  :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: 2px; }
  button:focus-visible, .btn:focus-visible, .icon-btn:focus-visible { outline-offset: 3px; }
  *:focus:not(:focus-visible) { outline: none; }

  /* ===================================
     RESPONSIVE
     =================================== */
  @media (max-width: 1200px) {
      .project-item { grid-template-columns: 30px 1fr 1.5fr 0.8fr 0.8fr 60px; grid-column-gap: 1rem; }
      .background-image { width: 600px; height: 450px; }
  }
  @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
  @media (max-width: 768px) {
      :root {
          --fab-size: 128px;
          --fab-bottom: calc(env(safe-area-inset-bottom) + clamp(14px, 3.5vh, 36px));
          --edge-blur: 8px; --edge-mask-i: 65%; --edge-mask-o: 80%;
      }
      .sheet { width: min(98vw, 560px); }
      .listview-root .portfolio-container { padding-top: calc(4rem + 80px); }
      .portfolio-container { padding: 0 1rem; }
      .project-item { grid-template-columns: 30px 1fr 1fr; grid-column-gap: 1rem; }
      .project-data:not(.artist):not(.album) { display: none; }
      .background-image { width: 400px; height: 300px; }
      .view-toggle, .zoom-presets { gap: 4px; padding: 4px; }
      .toggle-btn, .zoom-presets-btn { padding: 6px; }
  }
  @media (max-width: 500px) {
      .morphing-disclosure { font-size: 0.8125rem; }
      summary { padding: 0.75rem 0.875rem; }
      .content { padding: 0 0.875rem 0.875rem; }
      .title-bar h1 { font-size: 10px; }
      .close-button { width: 32px; height: 32px; }
  }

  .no-scroll { overflow: hidden; }

  @media print {
      .header, .controls, .fab-wrap, .hud, .view-toggle, .zoom-presets, .edge-blur, .vignette, .dark-layer, #cursor { display: none !important; }
      body { background: #fff; color: #000; cursor: auto; }
  }

  .fab, .icon-btn, .btn, .toggle-btn, .zoom-presets-btn, .project-item, details { transform: translateZ(0); backface-visibility: hidden; }

  /* ===================================
     INLINE EDITABLE CELLS — desktop (Namecheap DNS style)
     =================================== */

  /* Allow text selection inside inputs despite body rule */
  .cell-input, .cell-input * {
      -webkit-user-select: text !important;
      user-select: text !important;
      touch-action: auto !important;
  }

  .editable-cell {
      cursor: pointer;
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      border-radius: var(--border-radius-sm);
      transition: color 0.15s ease, background 0.15s ease;
      padding: 2px 4px;
      margin: -2px -4px;
  }
  .project-item:not(:hover) .editable-cell:hover {
      color: var(--ink) !important;
      background: rgba(255,255,255,0.05);
  }
  .edit-pencil {
      opacity: 0;
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      transition: opacity 0.15s ease;
      pointer-events: none;
  }
  .edit-pencil svg { width: 10px; height: 10px; }
  .project-item:not(:hover) .editable-cell:hover .edit-pencil { opacity: 1; }
  .project-item:hover .editable-cell .edit-pencil { opacity: 0.35; }
  .project-item:hover .editable-cell:hover .edit-pencil { opacity: 0.8; }

  /* Desktop inline editing state */
  .editing-cell {
      display: inline-flex !important;
      align-items: center;
      gap: 4px;
      background: rgba(0, 0, 0, 0.95) !important;
      border: 1px solid color-mix(in srgb, var(--accent) 50%, transparent) !important;
      border-radius: var(--border-radius-sm);
      padding: 1px 4px !important;
      margin: -3px -5px !important;
      color: var(--ink) !important;
      text-transform: none !important;
      letter-spacing: 0 !important;
      font-style: normal !important;
      z-index: 100;
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent), 0 4px 20px rgba(0,0,0,0.5);
  }
  .cell-input {
      background: none;
      border: none;
      outline: none;
      color: var(--ink);
      font-family: inherit;
      font-size: inherit;
      font-weight: inherit;
      letter-spacing: 0;
      text-transform: none;
      font-style: normal;
      min-width: 80px;
      max-width: 320px;
      padding: 2px 0;
      caret-color: var(--accent);
      cursor: text;
  }
  .project-data.artist .cell-input { font-style: normal; font-size: 22px; min-width: 120px; }
  .project-data.album .cell-input { font-size: 10px; min-width: 80px; }

  .cell-actions { display: inline-flex; align-items: center; gap: 2px; flex-shrink: 0; }
  .cell-action-btn {
      appearance: none; border: 1px solid var(--border); border-radius: 3px;
      background: rgba(255,255,255,0.06); cursor: pointer;
      font-size: 10px; line-height: 1; padding: 2px 5px; color: var(--ink-3);
      transition: background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
      font-family: var(--ui-font);
  }
  .cell-confirm { color: var(--accent); border-color: color-mix(in srgb, var(--accent) 40%, transparent); }
  .cell-confirm:hover { background: color-mix(in srgb, var(--accent) 20%, transparent); border-color: var(--accent); color: var(--accent); }
  .cell-cancel:hover { background: rgba(255,80,80,0.12); border-color: rgba(255,80,80,0.5); color: #ff6363; }
  .project-item:hover .editing-cell { background: rgba(0,0,0,0.95) !important; }
  .project-item:hover .editing-cell .cell-input { color: var(--ink) !important; }

  /* ===================================
     MOBILE EDITABLE ROWS (coarse pointer)
     On touch: show a persistent edit icon per row, tap row to expand
     into a full-width edit panel inside the row itself.
     =================================== */
  @media (pointer: coarse) {
      /* Always-visible edit affordance — small pencil chip on the right */
      .editable-cell { cursor: default; gap: 0; padding: 0; margin: 0; }
      .editable-cell:hover { color: inherit !important; background: none !important; }
      .edit-pencil { display: none !important; } /* hidden — tap target on row instead */

      /* Row tap area — entire row is the tap target, shows edit icon right-side */
      .project-item.is-editable {
          position: relative;
          cursor: pointer;
          -webkit-tap-highlight-color: rgba(218,165,32,0.08);
          touch-action: manipulation;
      }
      /* Persistent edit affordance chip in right gutter */
      .project-item.is-editable::after {
          content: "✎";
          position: absolute;
          right: 0;
          top: 50%;
          transform: translateY(-50%);
          font-size: 14px;
          color: var(--ink-3);
          opacity: 0.35;
          pointer-events: none;
          transition: opacity 0.15s ease;
          line-height: 1;
      }
      .project-item.is-editable:active::after { opacity: 0.8; }

      /* Expanded edit panel — overrides the grid layout */
      .project-item.mobile-editing {
          display: flex;
          flex-direction: column;
          align-items: stretch;
          padding: 12px 0 0;
          gap: 0;
          cursor: default;
          border-bottom-color: color-mix(in srgb, var(--accent) 30%, transparent);
          min-height: unset;
      }
      .project-item.mobile-editing::after { display: none; }
      /* Hide the normal grid columns when expanded */
      .project-item.mobile-editing .project-data { display: none !important; }

      /* The mobile edit panel itself */
      .mobile-edit-panel {
          display: none;
      }
      .project-item.mobile-editing .mobile-edit-panel {
          display: flex;
          flex-direction: column;
          gap: 8px;
          width: 100%;
          padding: 0 0 14px;
          animation: mobileEditOpen 0.22s cubic-bezier(0.25,1,0.5,1) both;
      }
      @keyframes mobileEditOpen {
          from { opacity: 0; transform: translateY(-6px); }
          to   { opacity: 1; transform: translateY(0); }
      }

      .mobile-edit-field {
          display: flex;
          flex-direction: column;
          gap: 4px;
      }
      .mobile-edit-label {
          font-family: var(--ui-font);
          font-size: 9px;
          letter-spacing: 0.1em;
          text-transform: uppercase;
          color: var(--ink-3);
          opacity: 0.6;
      }
      .mobile-edit-input {
          width: 100%;
          background: rgba(255,255,255,0.04);
          border: 1px solid var(--border);
          border-radius: var(--border-radius-md);
          padding: 11px 14px;
          font-family: var(--body-font);
          font-size: 18px;
          color: var(--ink);
          outline: none;
          caret-color: var(--accent);
          -webkit-user-select: text;
          user-select: text;
          touch-action: auto;
          -webkit-tap-highlight-color: transparent;
          transition: border-color 0.2s ease, background 0.2s ease;
      }
      .mobile-edit-input:focus {
          border-color: color-mix(in srgb, var(--accent) 50%, transparent);
          background: rgba(255,255,255,0.07);
          box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 10%, transparent);
      }
      .mobile-edit-input.title-input {
          font-size: 20px;
          font-style: italic;
          font-family: var(--body-font);
      }
      .mobile-edit-input.title-input:focus { font-style: normal; }

      .mobile-edit-actions {
          display: flex;
          gap: 8px;
          margin-top: 4px;
      }
      .mobile-edit-save {
          flex: 1;
          appearance: none;
          background: var(--accent);
          border: none;
          border-radius: var(--border-radius-md);
          color: #000;
          font-family: var(--ui-font);
          font-size: 11px;
          font-weight: 700;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          padding: 14px 20px;
          cursor: pointer;
          transition: filter 0.15s ease, transform 0.1s ease;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          min-height: 48px;
      }
      .mobile-edit-save:active { filter: brightness(1.12); transform: scale(0.98); }

      .mobile-edit-discard {
          appearance: none;
          background: rgba(255,255,255,0.05);
          border: 1px solid var(--border);
          border-radius: var(--border-radius-md);
          color: var(--ink-3);
          font-family: var(--ui-font);
          font-size: 11px;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          padding: 14px 20px;
          cursor: pointer;
          transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease, transform 0.1s ease;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          min-height: 48px;
      }
      .mobile-edit-discard:active { transform: scale(0.97); }

      /* Suppress desktop-only inline editing on touch */
      .editing-cell {
          display: inline !important;
          background: none !important;
          border: none !important;
          box-shadow: none !important;
          padding: 0 !important;
          margin: 0 !important;
      }
  }


</style>
</head>
<body>
  <svg height="0" width="0" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="goo">
      <defs>
          <filter id="goo">
              <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="6"></feGaussianBlur>
              <feColorMatrix in="blur" mode="matrix" result="goo" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 35 -15"></feColorMatrix>
              <feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite>
          </filter>
      </defs>
  </svg>
  
  <div id="cursor" aria-hidden="true"></div>
  <div id="root"></div>
  
  <div class="view-toggle">
      <button class="toggle-btn" id="gridBtn" title="Grid View">
          <svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
              <rect height="7" width="7" x="3" y="3"></rect>
              <rect height="7" width="7" x="14" y="3"></rect>
              <rect height="7" width="7" x="14" y="14"></rect>
              <rect height="7" width="7" x="3" y="14"></rect>
          </svg>
      </button>
      <button class="toggle-btn" id="listBtn" title="List View">
          <svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
              <line x1="8" x2="21" y1="6" y2="6"></line>
              <line x1="8" x2="21" y1="12" y2="12"></line>
              <line x1="8" x2="21" y1="18" y2="18"></line>
              <line x1="3" x2="3.01" y1="6" y2="6"></line>
              <line x1="3" x2="3.01" y1="12" y2="12"></line>
              <line x1="3" x2="3.01" y1="18" y2="18"></line>
          </svg>
      </button>
  </div>
  
  <!-- ═══════════════════════════════════════
       PAGE LOADER — cinematic image carousel
       ═══════════════════════════════════════ -->
  <div id="page-loader">
    <!-- Slides injected by JS -->
    <div class="pl-vignette"></div>
    <div class="pl-grain"></div>
    <div class="pl-corner">wolfie<span>.</span>life</div>
    <div class="pl-counter" id="pl-counter">—</div>
    <div class="pl-caption" id="pl-caption"></div>
    <div class="pl-ui">
      <div class="pl-wordmark">loading</div>
      <div class="pl-progress-track">
        <div class="pl-progress-fill" id="pl-progress"></div>
      </div>
    </div>
  </div>
  <!-- Legacy loader (kept for JS compat) -->
  <div id="loader" class="loader-overlay"></div>
  <div class="hud hud-left" title="View README">v1.4.1</div>
  <div class="hud hud-right" id="coordsMount">x 0 • y 0</div>

<div id="deleteConfirmOverlay" class="overlay">
  <div class="delete-confirm-dialog">
    <h3>Delete Item</h3>
    <p>Are you sure you want to delete this item? This action cannot be undone.</p>
    <div class="delete-confirm-buttons">
      <button class="btn btn-cancel" id="cancelDelete">Cancel</button>
      <button class="btn btn-delete" id="confirmDelete">Delete</button>
    </div>
  </div>
</div>

<div id="readmeOverlay" class="overlay-wrapper">
  <div class="title-bar">
    <h1>intoview • note — README</h1>
    <button class="close-button" id="readmeClose" aria-label="Close README">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
  <div class="container" style="grid-template-columns: 1fr; place-items: center;">
    <section class="section" style="max-width: 800px; width: 100%;">
      <h2 class="section-title">README</h2>
      <div class="morphing-disclosure" id="readme-disclosure">
        <details name="readme">
          <summary>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.25a.75.75 0 001 .707A8.237 8.237 0 016 18.75c1.995 0 3.823.707 5.25 1.886V4.533zM12.75 20.636A8.214 8.214 0 0118 18.75c.966 0 1.89.166 2.75.47a.75.75 0 001-.708V4.262a.75.75 0 00-.5-.707A9.735 9.735 0 0018 3a9.707 9.707 0 00-5.25 1.533v16.103z"/>
            </svg>
            <span>Overview</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd"/>
            </svg>
          </summary>
          <div class="content">
            <p><strong>intoview • note</strong> (v1.4.1) is a simple note-taking application built with React, Three.js, and GSAP. It merges creative presentation with a technical showcase.</p>
          </div>
        </details>

        <details name="readme">
          <summary>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M2.25 6a3 3 0 013-3h13.5a3 3 0 013 3v12a3 3 0 01-3 3H5.25a3 3 0 01-3-3V6zm3.97.97a.75.75 0 011.06 0l2.25 2.25a.75.75 0 010 1.06l-2.25 2.25a.75.75 0 01-1.06-1.06l1.72-1.72-1.72-1.72a.75.75 0 010-1.06zm4.28 4.28a.75.75 0 000 1.5h5.25a.75.75 0 000-1.5H10.5z" clip-rule="evenodd"/>
            </svg>
            <span>Core Stack</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd"/>
            </svg>
          </summary>
          <div class="content">
            <p>React 18.3.1 — UI framework</p>
            <p>Three.js + React Three Fiber — 3D graphics</p>
            <p>GSAP 3.12.5 — Animation system</p>
            <p>TypeScript/ES6 Modules</p>
          </div>
        </details>

        <details name="readme">
          <summary>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z" clip-rule="evenodd"/>
            </svg>
            <span>Design System</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd"/>
            </svg>
          </summary>
          <div class="content">
            <p>You know, playing with the morphisms, applying the knowns, venturing into the unknown. I have a nifty isometric grid I'm experimenting with elsewhere.</p>
          </div>
        </details>

        <details name="readme">
          <summary>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z"/>
              <path fill-rule="evenodd" d="M9.344 3.071a49.52 49.52 0 015.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 01-3 3h-15a3 3 0 01-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 001.11-.71l.822-1.315a2.942 2.942 0 012.332-1.39zM6.75 12.75a5.25 5.25 0 1110.5 0 5.25 5.25 0 01-10.5 0zm12-1.5a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd"/>
            </svg>
            <span>Interactions</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd"/>
            </svg>
          </summary>
          <div class="content">
            <p>Be kind while I iron out the kinks, but the premise is: Take a photo → Make a note → Carry along</p>
          </div>
        </details>

        <details name="readme">
          <summary>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7z"/>
            </svg>
            <span>Credits</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd"/>
            </svg>
          </summary>
          <div class="content">
            <p>If I may offer a relevant <strong>anecdote</strong>: I once worked at a big-deal agency for a big-deal client. Lots of fluff, lots of coasting, lots of individuals operating in silos. As an aside, we maintained our so-called "sprint schedule" in a password protected Keynote presentation. Anyway, our big-deal client came to us <strike>asking</strike> demanding we copy another big-deal agency's website navigation verbatim; note for note.</p>
            <p>So we did. But, no one asked why ~ except for me, I asked why and was summarily fired, but I digress ~ as it ultimately became clear such navigation schema did not meet their business requirements, nor objectives ~~~ It was, after all, a single-page website that served as the primary gateway into their gated marketplace, but nbd/ngl.</p>
            <p>Alas, as I develop my concept for <strong>intoview.pro</strong>, I am wanting to craft an experience that allows me to explore methods and techniques that <strong>frankly</strong>, those big-deal agencies cannot or will not do.</p>
            <p><small>Special thanks to the codepen community, codrops demos, and a case study I found for Phantom Studio's homepage grid.</small></p>
          </div>
        </details>
      </div>
    </section>
  </div>
</div>


<script type="module">

  import React, { useEffect, useMemo, useRef, useState, Suspense } from "https://esm.sh/react@18.3.1";
  import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";
  import * as THREE from "https://esm.sh/three@0.160.1";
  import {
      Canvas,
      useFrame,
      useThree,
  } from "https://esm.sh/@react-three/fiber@8.16.0?deps=react@18.3.1,react-dom@18.3.1,three@0.160.1";
  import gsap from "https://esm.sh/gsap@3.12.5";
  const SEED = [
      { src: "https://i.ibb.co/rRLkbvPw/wakinguptothisface.webp", title: "wakinguptothisface", caption: "" },
      { src: "https://i.ibb.co/35wn6dyd/sleepies.webp", title: "sleepies", caption: "" },
      { src: "https://i.ibb.co/7xVk4kZh/realitycheck.webp", title: "realitycheck", caption: "" },
      { src: "https://i.ibb.co/8g6xb5xh/pleased2.webp", title: "pleased2", caption: "" },
      { src: "https://i.ibb.co/q3w23YbL/pleased.webp", title: "pleased", caption: "" },
      { src: "https://i.ibb.co/5Xf4pWgs/penguin056.webp", title: "penguin056", caption: "" },
      { src: "https://i.ibb.co/HDpMfC96/penguin003.webp", title: "penguin003", caption: "" },
      { src: "https://i.ibb.co/Xx5xySV3/penguin002.webp", title: "penguin002", caption: "" },
      { src: "https://i.ibb.co/wFWhPJ1t/notaregulationseatbeltbutgreatlapwarmer.webp", title: "notaregulationseatbeltbutgreatlapwarmer", caption: "" },
      { src: "https://i.ibb.co/v4SyZC8n/newviews.webp", title: "newviews", caption: "" },
      { src: "https://i.ibb.co/ynXcRw2w/nightnight.webp", title: "nightnight", caption: "" },
      { src: "https://i.ibb.co/b5Y8SMh6/makingitwork.webp", title: "makingitwork", caption: "" },
      { src: "https://i.ibb.co/JR1SH0g3/justmaterialexcessweknowwhatmyfocusis.webp", title: "justmaterialexcessweknowwhatmyfocusis", caption: "" },
      { src: "https://i.ibb.co/C5T1nJzt/lowbudgetjoy.webp", title: "lowbudgetjoy", caption: "" },
      { src: "https://i.ibb.co/BKFKrbpj/instantlyourfavoritepasttime.webp", title: "instantlyourfavoritepasttime", caption: "" },
      { src: "https://i.ibb.co/5WSCNCy9/jeepsaturdaymornings.webp", title: "jeepsaturdaymornings", caption: "" },
      { src: "https://i.ibb.co/LzvMnZxL/earinfection.webp", title: "earinfection", caption: "" },
      { src: "https://i.ibb.co/LdfyKRHH/cozyinjeep.webp", title: "cozyinjeep", caption: "" },
      { src: "https://i.ibb.co/hnVKLCH/couldbeworse.webp", title: "couldbeworse", caption: "" },
      { src: "https://i.ibb.co/HLnKwLFc/cleandoggy.webp", title: "cleandoggy", caption: "" },
      { src: "https://i.ibb.co/d4H86rR9/classic005.webp", title: "classic005", caption: "" },
      { src: "https://i.ibb.co/SXcTfppx/classicwolfgangblur.webp", title: "classicwolfgangblur", caption: "" },
      { src: "https://i.ibb.co/ccwfC9Zc/anywherehegoes.webp", title: "anywherehegoes", caption: "" },
      { src: "https://i.ibb.co/tpD56r7n/backinbrooklyn.webp", title: "backinbrooklyn", caption: "" },
      { src: "https://i.ibb.co/84scKcfG/beans.jpg", title: "beans", caption: "" },
      { src: "https://i.ibb.co/27c34fPD/allstitchedup.jpg", title: "allstitchedup", caption: "" },
      { src: "https://i.ibb.co/BV4C58zX/whenyouletastrangerintoyourhomeandtheygoforyourfridge.jpg", title: "whenyouletastrangerintoyourhomeandtheygoforyourfridge", caption: "" },
      { src: "https://i.ibb.co/rfKXyv3q/theveryfirstofclassicwolfgang.jpg", title: "theveryfirstofclassicwolfgang", caption: "" },
      { src: "https://i.ibb.co/x8DxKNgy/someoneissnoring.jpg", title: "someoneissnoring", caption: "" },
      { src: "https://i.ibb.co/nsp6BwTS/socks1.jpg", title: "socks1", caption: "" },
      { src: "https://i.ibb.co/hJRKrSTv/socks2.jpg", title: "socks2", caption: "" },
      { src: "https://i.ibb.co/PGxhw6SC/pumpkin12345.jpg", title: "pumpkin12345", caption: "" },
      { src: "https://i.ibb.co/SDBHyLHB/park123.jpg", title: "park123", caption: "" },
      { src: "https://i.ibb.co/gMfpCbRW/owl.jpg", title: "owl", caption: "" },
      { src: "https://i.ibb.co/gqbRRr5/mysweetpumpkin.jpg", title: "mysweetpumpkin", caption: "" },
      { src: "https://i.ibb.co/DDyHhwTm/lostinqueens.jpg", title: "lostinqueens", caption: "" },
      { src: "https://i.ibb.co/SDb2ZDG1/longboy.jpg", title: "longboy", caption: "" },
      { src: "https://i.ibb.co/v6qr7CxQ/gorgeousgoodboy.jpg", title: "gorgeousgoodboy", caption: "" },
      { src: "https://i.ibb.co/TMxmFknH/fallinginlove1.jpg", title: "fallinginlove1", caption: "" },
      { src: "https://i.ibb.co/YBQ5pvfW/fellinlove1.jpg", title: "fellinlove1", caption: "" },
      { src: "https://i.ibb.co/gb3mMDBt/wolfgangsfirsttimeinthejeep.webp", title: "wolfgangsfirsttimeinthejeep", caption: "" },
      { src: "https://i.ibb.co/QjqjMtpN/mamaweremovingout.webp", title: "mamaweremovingout", caption: "" },
      { src: "https://i.ibb.co/G4qDyqZH/surviorandthriverfullcolor.webp", title: "surviorandthriverfullcolor", caption: "" },
      { src: "https://i.ibb.co/VYC0hyxW/surviorandthriver.webp", title: "surviorandthriver", caption: "" },
      { src: "https://i.ibb.co/rRfMt4Fj/happyboy.webp", title: "happyboy", caption: "" },
      { src: "https://i.ibb.co/0Rt0KW93/wolfgangsfinestworkmoment.webp", title: "wolfgangsfinestworkmoment", caption: "" },
      { src: "https://i.ibb.co/LXBkfzbw/wolfgangsfinestwork.webp", title: "wolfgangsfinestwork", caption: "" },
      { src: "https://i.ibb.co/rKbH2FFx/sweetestwolfgang.webp", title: "sweetestwolfgang", caption: "" },
      { src: "https://i.ibb.co/JwdP8xFc/floating.webp", title: "floating", caption: "" },
      { src: "https://i.ibb.co/DsT5Ppk/lostinqueens.webp", title: "lostinqueens", caption: "" },
      { src: "https://i.ibb.co/LXR70BTD/wolfieboop.webp", title: "wolfieboop", caption: "" },
      { src: "https://i.ibb.co/7tm2QB7X/whereiswolfgang.webp", title: "whereiswolfgang", caption: "" },
      { src: "https://i.ibb.co/d0MxCR6m/delicious.webp", title: "delicious", caption: "" },
      { src: "https://i.ibb.co/Jj1Pc7bs/theabsolutecutestthingihaveeverseen.webp", title: "theabsolutecutestthingihaveeverseen", caption: "" },
      { src: "https://i.ibb.co/gbwLMFZw/snoopboop.webp", title: "snoopboop", caption: "" },
      { src: "https://i.ibb.co/6J8QRGXg/sothisiswolfgang.webp", title: "sothisiswolfgang", caption: "" },
      { src: "https://i.ibb.co/9HkZnDDn/wolfgangserenade.webp", title: "wolfgangserenade", caption: "" },
      { src: "https://i.ibb.co/m5sZdcgC/youbelongtomenow.webp", title: "youbelongtomenow", caption: "" },
      { src: "https://i.ibb.co/gQPNJXc/xlnexttimeplease.webp", title: "xlnexttimeplease", caption: "" },
      { src: "https://i.ibb.co/qLJnHFK3/workinghard.webp", title: "workinghard", caption: "" },
      { src: "https://i.ibb.co/BX5RVPg/wolfgangownsallofmyhoodies.webp", title: "wolfgangownsallofmyhoodies", caption: "" },
      { src: "https://i.ibb.co/35xyhPFJ/wolfgangkeepingthingscalm.webp", title: "wolfgangkeepingthingscalm", caption: "" },
      { src: "https://i.ibb.co/mrsF2PP2/whereiswolfgang.webp", title: "whereiswolfgang", caption: "" },
      { src: "https://i.ibb.co/35ngjfQK/wheneverthingaroundyouisfallingapart.webp", title: "wheneverthingaroundyouisfallingapart", caption: "" },
      { src: "https://i.ibb.co/WvSsz44X/whendadworksfromhomesoyougettheenviablewindowofficewithfreemassuese.webp", title: "whendadworksfromhomesoyougettheenviablewindowofficewithfreemassuese", caption: "" },
      { src: "https://i.ibb.co/HDvw7qqm/wegmansnyc.webp", title: "wegmansnyc", caption: "" },
      { src: "https://i.ibb.co/9kCB3w9J/wawa654.webp", title: "wawa654", caption: "" },
      { src: "https://i.ibb.co/MXkwD0q/wawa234.webp", title: "wawa234", caption: "" },
      { src: "https://i.ibb.co/8DMQ7yXX/water98765432.webp", title: "water98765432", caption: "" },
      { src: "https://i.ibb.co/4310LRy/water4567.webp", title: "water4567", caption: "" },
      { src: "https://i.ibb.co/Sw4Y7kj1/warmly.webp", title: "warmly", caption: "" },
      { src: "https://i.ibb.co/cc6TDDwc/warminguptothewonderofwolfgang.webp", title: "warminguptothewonderofwolfgang", caption: "" },
      { src: "https://i.ibb.co/4nKyYjhT/walkwolfgangsway.webp", title: "walkwolfgangsway", caption: "" },
      { src: "https://i.ibb.co/ZRH2xfpx/vet-trip.webp", title: "vet trip", caption: "" },
      { src: "https://i.ibb.co/twNdHLNd/vera2.webp", title: "vera2", caption: "" },
      { src: "https://i.ibb.co/7Nb3kzfB/vera1.webp", title: "vera1", caption: "" },
      { src: "https://i.ibb.co/8Wbt6Jw/uhmtotallyfellasleepwithselfiemodereadyohlookathispawsomg.webp", title: "uhmtotallyfellasleepwithselfiemodereadyohlookathispawsomg", caption: "" },
      { src: "https://i.ibb.co/KjCG862F/traininghumanonmyfavoritethingtodoperiod.webp", title: "traininghumanonmyfavoritethingtodoperiod", caption: "" },
      { src: "https://i.ibb.co/GvH63fQ8/thisthisisthevalidationiseek.webp", title: "thisthisisthevalidationiseek", caption: "" },
      { src: "https://i.ibb.co/83SsR99/thislittledudeexudedsomuchconfidence.webp", title: "thislittledudeexudedsomuchconfidence", caption: "" },
      { src: "https://i.ibb.co/gMPHfGpX/thekitchen.webp", title: "thekitchen", caption: "" },
      { src: "https://i.ibb.co/C3GsbwmT/thegoattheking.webp", title: "thegoattheking", caption: "" },
      { src: "https://i.ibb.co/Z1Xfwcx6/sunlightsweetheart.webp", title: "sunlightsweetheart", caption: "" },
      { src: "https://i.ibb.co/PvvP2j91/stolesomeofdadsicecream.webp", title: "stolesomeofdadsicecream", caption: "" },
      { src: "https://i.ibb.co/zWbFdGF8/sowolfgangdiscoveredpupcupsatprettymucheverysheetz.webp", title: "sowolfgangdiscoveredpupcupsatprettymucheverysheetz", caption: "" },
      { src: "https://i.ibb.co/9k9fX8wp/somewhere987654.webp", title: "somewhere987654", caption: "" },
      { src: "https://i.ibb.co/9kggF1YH/somewhere765432.webp", title: "somewhere765432", caption: "" },
      { src: "https://i.ibb.co/Vc6RjkkH/somewhere234567.webp", title: "somewhere234567", caption: "" },
      { src: "https://i.ibb.co/5xFrKhBM/someoneorderaburgerforbreakfastwhilebrokendown.webp", title: "someoneorderaburgerforbreakfastwhilebrokendown", caption: "" },
      { src: "https://i.ibb.co/HfC0qCGB/shitsupervisor.webp", title: "shitsupervisor", caption: "" },
      { src: "https://i.ibb.co/DHyNdP33/saturdaymornings.webp", title: "saturdaymornings", caption: "" },
      { src: "https://i.ibb.co/r2gFFwNf/oneofwolfgangsfavoriteplaces.webp", title: "oneofwolfgangsfavoriteplaces", caption: "" },
      { src: "https://i.ibb.co/4rnzNzt/oncetheworkisdone2.webp", title: "oncetheworkisdone2", caption: "" },
      { src: "https://i.ibb.co/XkGPG8D3/oncetheworkisdone.webp", title: "oncetheworkisdone", caption: "" },
      { src: "https://i.ibb.co/CFN84JX/okyouwin.webp", title: "okyouwin", caption: "" },
      { src: "https://i.ibb.co/HpxfkCrY/okfine.webp", title: "okfine", caption: "" },
      { src: "https://i.ibb.co/NdZQSPdr/okayletsgo.webp", title: "okayletsgo", caption: "" },
      { src: "https://i.ibb.co/sv5nN8nY/ohwhatisthismine.webp", title: "ohwhatisthismine", caption: "" },
      { src: "https://i.ibb.co/q3Tk5HWP/ohwhatisthis.webp", title: "ohwhatisthis", caption: "" },
      { src: "https://i.ibb.co/670vRLTm/ohwhat.webp", title: "ohwhat", caption: "" },
      { src: "https://i.ibb.co/zV0b262F/ohwater.webp", title: "ohwater", caption: "" },
      { src: "https://i.ibb.co/LdgdfZDM/ohformewhyyoushoulnthave.webp", title: "ohformewhyyoushoulnthave", caption: "" },
      { src: "https://i.ibb.co/5gPCWkDf/nownamedgivenanappropriatemohawk.webp", title: "nownamedgivenanappropriatemohawk", caption: "" },
      { src: "https://i.ibb.co/B5NW72rq/noleashfromdayone.webp", title: "noleashfromdayone", caption: "" },
      { src: "https://i.ibb.co/TDHdkN3w/mypal.webp", title: "mypal", caption: "" },
      { src: "https://i.ibb.co/Ngj3qTkw/mylittleguy.webp", title: "mylittleguy", caption: "" },
      { src: "https://i.ibb.co/qFVszwVN/mylittledonut.webp", title: "mylittledonut", caption: "" },
      { src: "https://i.ibb.co/bjK8FYHX/mydreamwastoownacafejustforwolfietohangoutin.webp", title: "mydreamwastoownacafejustforwolfietohangoutin", caption: "" },
      { src: "https://i.ibb.co/Y7cJj7Vc/muralist.webp", title: "muralist", caption: "" },
      { src: "https://i.ibb.co/d0bT8TBD/metallicafanprobably.webp", title: "metallicafanprobably", caption: "" },
      { src: "https://i.ibb.co/zh2ZrzgJ/lowestoflowsbutstabilityforwolfgang.webp", title: "lowestoflowsbutstabilityforwolfgang", caption: "" },
      { src: "https://i.ibb.co/M5jT7kWj/lovethisface.webp", title: "lovethisface", caption: "" },
      { src: "https://i.ibb.co/nNKFYj1B/loveshadowheart.webp", title: "loveshadowheart", caption: "" },
      { src: "https://i.ibb.co/JjVcwMw8/lovebruh.webp", title: "lovebruh", caption: "" },
      { src: "https://i.ibb.co/bRy3QhNL/tabletoppoodle.webp", title: "tabletoppoodle", caption: "" },
      { src: "https://i.ibb.co/vCYxMRbG/lookiftheysayanythingiamheretokeepyouontask.webp", title: "lookiftheysayanythingiamheretokeepyouontask", caption: "" },
      { src: "https://i.ibb.co/JwmvLQmx/likemyexgirlfriendhoodiereowner.webp", title: "likemyexgirlfriendhoodiereowner", caption: "" },
      { src: "https://i.ibb.co/21Npmk7W/lifestylegoalsachieved.webp", title: "lifestylegoalsachieved", caption: "" },
      { src: "https://i.ibb.co/RGJjnMpL/laleedaa.webp", title: "laleedaa", caption: "" },
      { src: "https://i.ibb.co/LXbb1yqN/jobwelldone.webp", title: "jobwelldone", caption: "" },
      { src: "https://i.ibb.co/jZ66mwX7/itsthisexactlookthatgetsmeeverysingletime.webp", title: "itsthisexactlookthatgetsmeeverysingletime", caption: "" },
      { src: "https://i.ibb.co/Mm07h9F/ilovehim.webp", title: "ilovehim", caption: "" },
      { src: "https://i.ibb.co/d4SkHwfB/icecream45678.webp", title: "icecream45678", caption: "" },
      { src: "https://i.ibb.co/whFvFR24/hydratedandhappy.webp", title: "hydratedandhappy", caption: "" },
      { src: "https://i.ibb.co/r2ynCVfQ/homeiswhereyourest.webp", title: "homeiswhereyourest", caption: "" },
      { src: "https://i.ibb.co/Ldmrtb7t/hislittleblacklips.webp", title: "hislittleblacklips", caption: "" },
      { src: "https://i.ibb.co/DHFBm7HM/hisfavoritecafe.webp", title: "hisfavoritecafe", caption: "" },
      { src: "https://i.ibb.co/fVrBVSpn/hideyourdogatworkday.webp", title: "hideyourdogatworkday", caption: "" },
      { src: "https://i.ibb.co/0RLXVg2g/hidaddy.webp", title: "hidaddy", caption: "" },
      { src: "https://i.ibb.co/JjGbm5rh/heydaddy.webp", title: "heydaddy", caption: "" },
      { src: "https://i.ibb.co/zWcGkYxT/haircut87654.webp", title: "haircut87654", caption: "" },
      { src: "https://i.ibb.co/XZD5kPCs/haircut.webp", title: "haircut", caption: "" },
      { src: "https://i.ibb.co/8L68BJFv/guardian.webp", title: "guardian", caption: "" },
      { src: "https://i.ibb.co/7NBXqNfS/foreman.webp", title: "foreman", caption: "" },
      { src: "https://i.ibb.co/YJbXh7S/fluffy.webp", title: "fluffy", caption: "" },
      { src: "https://i.ibb.co/XxZ9sYZc/fivehundredmileroadtripfromwestvirginia.webp", title: "fivehundredmileroadtripfromwestvirginia", caption: "" },
      { src: "https://i.ibb.co/S45KWTfz/firstsnow.webp", title: "firstsnow", caption: "" },
      { src: "https://i.ibb.co/93zWzBDm/firesidefavorites2.webp", title: "firesidefavorites2", caption: "" },
      { src: "https://i.ibb.co/mVKrQG5s/firesidefavorites.webp", title: "firesidefavorites", caption: "" },
      { src: "https://i.ibb.co/nNJTsKj4/everyherohasagoodoriginstory.webp", title: "everyherohasagoodoriginstory", caption: "" },
      { src: "https://i.ibb.co/8g0HH5XG/elephantbywolfgang.webp", title: "elephantbywolfgang", caption: "" },
      { src: "https://i.ibb.co/NDk7kcW/drivethruluxurysuite.webp", title: "drivethruluxurysuite", caption: "" },
      { src: "https://i.ibb.co/3YQQ7hBK/drivethru.webp", title: "drivethru", caption: "" },
      { src: "https://i.ibb.co/v9qfSnz/donthidebehindpillowbecomepillow.webp", title: "donthidebehindpillowbecomepillow", caption: "" },
      { src: "https://i.ibb.co/SDxTXcYS/dinnerforwolfgang.webp", title: "dinnerforwolfgang", caption: "" },
      { src: "https://i.ibb.co/XxvXrgTn/deersteakhedidnoteatit.webp", title: "deersteakhedidnoteatit", caption: "" },
      { src: "https://i.ibb.co/XfJYXCw4/dailydrip.webp", title: "dailydrip", caption: "" },
      { src: "https://i.ibb.co/yFLwD4nv/dadhastogotoameetingsimpromptucampingadventure.webp", title: "dadhastogotoameetingsimpromptucampingadventure", caption: "" },
      { src: "https://i.ibb.co/fV6xyHmQ/couchsurfing.webp", title: "couchsurfing", caption: "" },
      { src: "https://i.ibb.co/Kcfy2q4h/classic6543.webp", title: "classic6543", caption: "" },
      { src: "https://i.ibb.co/4RLZnZR1/catshouse.webp", title: "catshouse", caption: "" },
      { src: "https://i.ibb.co/Hy8XwrB/calminganywhere.webp", title: "calminganywhere", caption: "" },
      { src: "https://i.ibb.co/4RfTWWkp/burgerkingindeed.webp", title: "burgerkingindeed", caption: "" },
      { src: "https://i.ibb.co/twP8m5wP/buildingburgerking.webp", title: "buildingburgerking", caption: "" },
      { src: "https://i.ibb.co/3yYzQLjP/braveboy.webp", title: "braveboy", caption: "" },
      { src: "https://i.ibb.co/F4wPJkk8/beefdinneringravy.webp", title: "beefdinneringravy", caption: "" },
      { src: "https://i.ibb.co/n8Q5B3NT/atleastthegravyisgood.webp", title: "atleastthegravyisgood", caption: "" },
      { src: "https://i.ibb.co/5XLHJ6h3/assorgrasslass.webp", title: "assorgrasslass", caption: "" },
      { src: "https://i.ibb.co/mrphxssF/angel987654.webp", title: "angel987654", caption: "" },
      { src: "https://i.ibb.co/MxGzxSVk/wolfgang00.webp", title: "wolfgang00", caption: "" },
      { src: "https://i.ibb.co/Swk4v5Tv/wolfgang000.webp", title: "wolfgang000", caption: "" },
      { src: "https://i.ibb.co/KJ9pcSh/sowolfiehatedtherain.webp", title: "sowolfiehatedtherain", caption: "" },
      { src: "https://i.ibb.co/nsKMYrDs/sowhatareyouupto.webp", title: "sowhatareyouupto", caption: "" },
      { src: "https://i.ibb.co/9kNPNs8m/refresher.webp", title: "refresher", caption: "" },
      { src: "https://i.ibb.co/wZ4jL08Y/precious.webp", title: "precious", caption: "" },
      { src: "https://i.ibb.co/93bMTmpY/newtothis.webp", title: "newtothis", caption: "" },
      { src: "https://i.ibb.co/xS9ChmKq/mowhawkwide.webp", title: "mowhawkwide", caption: "" },
      { src: "https://i.ibb.co/xqv72y7c/mohawk.webp", title: "mohawk", caption: "" },
      { src: "https://i.ibb.co/LdR4cY9N/loveinastoriabw.webp", title: "loveinastoriabw", caption: "" },
      { src: "https://i.ibb.co/KxhDw7nS/loveinastoria.webp", title: "loveinastoria", caption: "" },
      { src: "https://i.ibb.co/SXWPr4vf/likereallyreallyhatedtherain.webp", title: "likereallyreallyhatedtherain", caption: "" },
      { src: "https://i.ibb.co/mCy62tkg/likereallyhatedtherain.webp", title: "likereallyhatedtherain", caption: "" },
      { src: "https://i.ibb.co/BKymJdYK/itshisworld.webp", title: "itshisworld", caption: "" },
      { src: "https://i.ibb.co/qYS6Vj2h/improviseasolutionreallydad.webp", title: "improviseasolutionreallydad", caption: "" },
      { src: "https://i.ibb.co/bRs7ZLrj/improviseasolution.webp", title: "improviseasolution", caption: "" },
      { src: "https://i.ibb.co/fVYPWX91/hoodie2.webp", title: "hoodie2", caption: "" },
      { src: "https://i.ibb.co/dwNhjGPZ/hoodie1.webp", title: "hoodie1", caption: "" },
      { src: "https://i.ibb.co/M5Pcy9f9/homemademeals.webp", title: "homemademeals", caption: "" },
      { src: "https://i.ibb.co/N6dbht9r/hehateditsomuch.webp", title: "hehateditsomuch", caption: "" },
      { src: "https://i.ibb.co/CknqHpK/happierinnewyork.webp", title: "happierinnewyork", caption: "" },
      { src: "https://i.ibb.co/TBLbZpNb/fiveminuteslater.webp", title: "fiveminuteslater", caption: "" },
      { src: "https://i.ibb.co/tw52Ly7b/firstfewweekswithwolfgang.webp", title: "firstfewweekswithwolfgang", caption: "" },
      { src: "https://i.ibb.co/RkxhHy9n/curbyourdogbw.webp", title: "curbyourdogbw", caption: "" },
      { src: "https://i.ibb.co/HTqtChHv/curbyourdog.webp", title: "curbyourdog", caption: "" },
      { src: "https://i.ibb.co/kV6CzpWS/comfort2.webp", title: "comfort2", caption: "" },
      { src: "https://i.ibb.co/qfBwLrD/comfort1.webp", title: "comfort1", caption: "" },
      { src: "https://i.ibb.co/qFjdZ2Py/classicwolfgang777.webp", title: "classicwolfgang777", caption: "" },
      { src: "https://i.ibb.co/8n5gkh5v/classicwolfgang65.webp", title: "classicwolfgang65", caption: "" },
      { src: "https://i.ibb.co/wF05mLW2/joyful.webp", title: "joyful", caption: "" },
      { src: "https://i.ibb.co/Q7qvD3p8/atthismomentidecidedhewasmine.webp", title: "atthismomentidecidedhewasmine", caption: "" },
  ];
  const STORAGE_KEY = "intoview_archive_cards_v6";
  const CONFIG = {
      cols: 10,
      rows: 7,
      tile: 0.32,
      gap: 0.02,
      ambient: 0.2,
      dragEase: 0.14,
      velEase: 0.92,
      zoomOut: 1.85,
      distortion: { flat: 0.0, curved: 0.225 },
      clickBounceDelta: 0.25,
      longPressMsMouse: 380,
      longPressMsTouch: 520,
      clickMovePx: 6,
      clickMovePxTouch: 8,
      dragMultMouse: 6.0,
      dragMultTouch: 3.5,
      touchDragEase: 0.16,
      zoomMin: 0.25,
      zoomMax: 3.0,
      wheelScale: 0.0015,
      boundSlack: 0.6,
      rubber: 0.33,
      magnet: 0.12,
  };
  function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
          const later = () => {
              clearTimeout(timeout);
              func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
      };
  }
  const TEX_SIZE = 768,
      HAIR = 1,
      BAR_H = 28,
      PAD = 12,
      CAP_SIZE = 18,
      TITLE_SIZE = 20;
  const MONO = "'Space Mono', monospace";
  const UI = "'Space Mono', monospace";
  const isBlobOrData = (u) => /^blob:|^data:/i.test(u);
  function nowTS() {
      const d = new Date(),
          y = d.getFullYear(),
          m = String(d.getMonth() + 1).padStart(2, "0"),
          day = String(d.getDate()).padStart(2, "0"),
          hh = String(d.getHours()).padStart(2, "0"),
          mm = String(d.getMinutes()).padStart(2, "0");
      return `${y}-${m}-${day} • ${hh}:${mm}`;
  }
  
  // OPTIMIZATION: Concurrency Limiter for Image Load Queue
  const imageCache = new Map();
  const textureCache = new Map();
  const loadQueue = [];
  let activeLoads = 0;
  const MAX_CONCURRENT = 6; 

  function processLoadQueue() {
      if (activeLoads >= MAX_CONCURRENT || loadQueue.length === 0) return;
      activeLoads++;
      const { url, resolve, reject } = loadQueue.shift();
      
      const img = new Image();
      if (!/^blob:|^data:/i.test(url)) img.crossOrigin = "anonymous";
      img.onload = () => {
          imageCache.set(url, img);
          resolve(img);
          activeLoads--;
          processLoadQueue();
      };
      img.onerror = () => {
          reject(new Error("img load failed: " + url));
          activeLoads--;
          processLoadQueue();
      };
      img.src = url;
  }

  function loadImage(url) {
      if (imageCache.has(url)) return Promise.resolve(imageCache.get(url));
      return new Promise((resolve, reject) => {
          loadQueue.push({ url, resolve, reject });
          processLoadQueue();
      });
  }

  function drawHair(ctx, x, y, w) {
      ctx.fillStyle = "rgba(255,255,255,0.6)";
      ctx.fillRect(x, y, w, HAIR);
  }
  function coverImage(ctx, img, x, y, w, h) {
      const iw = img?.naturalWidth || img?.width || 0,
          ih = img?.naturalHeight || img?.height || 0;
      if (!iw || !ih) {
          ctx.fillStyle = "#111";
          ctx.fillRect(x, y, w, h);
          return;
      }
      const ir = iw / ih,
          ar = w / h;
      let dw, dh, dx, dy;
      if (ir > ar) {
          dh = h;
          dw = ir * h;
          dx = x + (w - dw) / 2;
          dy = y;
      } else {
          dw = w;
          dh = w / ir;
          dx = x;
          dy = y + (h - dh) / 2;
      }
      ctx.imageSmoothingQuality = "high";
      ctx.drawImage(img, dx, dy, dw, dh);
      ctx.fillStyle = "rgba(0,0,0,0.03)";
      ctx.fillRect(x, y, w, h);
  }
  function roundRect(ctx, x, y, w, h, r) {
      const rr = Math.min(r, w / 2, h / 2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
  }
  function drawChromeBezel(ctx, s, opts = {}) {
      const w = Math.max(4, opts.width ?? 1);
      const r = Math.min(12, opts.radius ?? 4);
      ctx.save();
      ctx.translate(0.5, 0.5);
      const grad = ctx.createLinearGradient(0, 0, 0, s);
      grad.addColorStop(0.0, "rgba(255,255,255,0.95)");
      grad.addColorStop(0.15, "rgba(210,210,210,0.78)");
      grad.addColorStop(0.5, "rgba(242,242,242,0.95)");
      grad.addColorStop(0.85, "rgba(210,210,210,0.78)");
      grad.addColorStop(1.0, "rgba(255,255,255,0.95)");
      ctx.strokeStyle = grad;
      ctx.lineWidth = w;
      ctx.lineJoin = "round";
      ctx.lineCap = "round";
      roundRect(ctx, w / 2, w / 2, s - w, s - w, r);
      ctx.stroke();
      ctx.strokeStyle = "rgba(255,255,255,0.95)";
      ctx.lineWidth = 1;
      roundRect(ctx, w + 0.5, w + 0.5, s - 2 * w - 1, s - 2 * w - 1, Math.max(2, r - 2));
      ctx.stroke();
      ctx.restore();
  }
  function makeCardCanvas({ img, title = "[ title ]", caption = "[ caption ]", gps = "", ts = nowTS() }) {
      const s = TEX_SIZE,
          c = document.createElement("canvas");
      c.width = s;
      c.height = s;
      const ctx = c.getContext("2d");
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, s, s);
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, s, BAR_H);
      ctx.font = `600 ${TITLE_SIZE}px ${UI}`;
      ctx.fillStyle = "#e6e6e6";
      ctx.textBaseline = "top";
      ctx.textAlign = "left";
      ctx.fillText(title, PAD, Math.floor((BAR_H - TITLE_SIZE) / 2));
      if (gps) {
          ctx.font = `500 12px ${MONO}`;
          ctx.textBaseline = "middle";
          ctx.textAlign = "right";
          ctx.fillStyle = "#cfcfcf";
          ctx.fillText(gps, s - PAD, BAR_H / 2);
          ctx.textAlign = "left";
      }
      drawHair(ctx, 0, BAR_H, s);
      const imgTop = BAR_H + HAIR,
          imgH = s - imgTop - (BAR_H + HAIR);
      if (img) {
          coverImage(ctx, img, 0, imgTop, s, imgH);
      } else {
          const BORDER_W = 4;
          ctx.fillStyle = "#000";
          ctx.fillRect(0, imgTop, s, imgH);
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = BORDER_W;
          ctx.strokeRect(BORDER_W / 2, imgTop + BORDER_W / 2, s - BORDER_W, imgH - BORDER_W);
      }
      drawHair(ctx, 0, s - BAR_H - HAIR, s);
      ctx.fillStyle = "#000";
      ctx.fillRect(0, s - BAR_H, s, BAR_H);
      ctx.font = `500 ${CAP_SIZE}px ${UI}`;
      ctx.fillStyle = "#e6e6e6";
      ctx.textBaseline = "middle";
      ctx.textAlign = "left";
      ctx.fillText(caption, PAD, s - BAR_H / 2);
      ctx.font = `500 12px ${MONO}`;
      ctx.fillStyle = "#cfcfcf";
      ctx.textAlign = "right";
      ctx.fillText(ts, s - PAD, s - BAR_H / 2);
      drawChromeBezel(ctx, s, { width: 1, radius: 0 });
      return c;
  }
  function makeCardTextureFromCanvas(cnv) {
      const tex = new THREE.CanvasTexture(cnv);
      tex.format = THREE.RGBAFormat;
      tex.colorSpace = THREE.SRGBColorSpace;
      tex.wrapS = THREE.ClampToEdgeWrapping;
      tex.wrapT = THREE.ClampToEdgeWrapping;
      tex.anisotropy = 8;
      tex.needsUpdate = !0;
      return tex;
  }
  function makeEmptyTexture() {
      if (textureCache.has("__empty")) return textureCache.get("__empty");
      const tex = makeCardTextureFromCanvas(makeCardCanvas({ img: null, title: "", caption: "", gps: "", ts: "" }));
      textureCache.set("__empty", tex);
      return tex;
  }
  async function textureForItem(item) {
      const cacheKey = item.id || item.src || (item.placeholder ? item.id : null);
      if (!cacheKey) {
          if (item?.placeholder)
              return makeCardTextureFromCanvas(
                  makeCardCanvas({
                      img: null,
                      title: item.title || "new note",
                      caption: item.caption || "tap to start",
                      gps: "",
                      ts: "",
                  })
              );
          return makeEmptyTexture();
      }
      if (textureCache.has(cacheKey)) {
          return textureCache.get(cacheKey);
      }
      if (item?.placeholder) {
          const cnv = makeCardCanvas({
              img: null,
              title: item.title || "new note",
              caption: item.caption || "tap to start",
              gps: "",
              ts: "",
          });
          const tex = makeCardTextureFromCanvas(cnv);
          textureCache.set(cacheKey, tex);
          return tex;
      }
      if (!item || !item.src) return makeEmptyTexture();
      if (item.baked) {
          try {
              const img = await loadImage(item.src);
              const tex = new THREE.Texture(img);
              tex.colorSpace = THREE.SRGBColorSpace;
              tex.anisotropy = 8;
              tex.needsUpdate = !0;
              textureCache.set(cacheKey, tex);
              return tex;
          } catch (e) {
              console.warn(e);
              return makeEmptyTexture();
          }
      }
      const img = await loadImage(item.src).catch((e) => {
          console.warn(e);
          return null;
      });
      const cnv = makeCardCanvas({
          img,
          title: item.title || "",
          caption: item.caption || "—",
          gps: item.gps || "",
          ts: item.ts || nowTS(),
      });
      const tex = makeCardTextureFromCanvas(cnv);
      textureCache.set(cacheKey, tex);
      return tex;
  }
  class DistortionShader extends THREE.ShaderMaterial {
      constructor() {
          super({
              name: "DistortionShader",
              uniforms: { tDiffuse: { value: null }, distortion: { value: new THREE.Vector2(0, 0) } },
              vertexShader: `varying vec2 vUv; void main(){ vUv=uv; gl_Position=vec4(position,1.0); }`,
              fragmentShader: `precision highp float; uniform sampler2D tDiffuse; uniform vec2 distortion; varying vec2 vUv;
    vec2 s(vec2 uv){ return 2.0*(uv-0.5);} vec2 u(vec2 suv){ return suv*0.5+0.5;}
    void main(){ vec2 suv=s(vUv); suv*=(0.88 + distortion*dot(suv,suv)); vec2 uv2=u(suv);
      vec3 col=texture2D(tDiffuse, uv2).rgb; gl_FragColor=vec4(col,1.0); }`,
          });
          this._dist = 0;
          this.update();
      }
      update() {
          const w = innerWidth,
              h = innerHeight,
              r = Math.min(w, h) / Math.max(w, h);
          this.uniforms.distortion.value.set(this._dist * r, this._dist * r);
      }
      setDistortion(v) {
          gsap.to(this, { _dist: v, duration: 1, ease: "power2.out", onUpdate: () => this.update() });
      }
  }
  const distortionShader = new DistortionShader();
  function updateDistortion(shader) {
      const w = innerWidth,
          h = innerHeight,
          r = Math.min(w, h) / Math.max(w, h);
      shader.uniforms.distortion.value.set(shader._dist * r, shader._dist * r);
  }
  window.addEventListener(
      "resize",
      debounce(() => updateDistortion(distortionShader), 100)
  );
  function BracketOverlay() {
      const { scene, size } = useThree();
      const matRef = useRef(null);
      useEffect(() => {
          const geom = new THREE.PlaneGeometry(2, 2);
          const mat = new THREE.ShaderMaterial({
              name: "BracketOverlay",
              transparent: !0,
              depthTest: !1,
              depthWrite: !1,
              uniforms: {
                  resolution: { value: new THREE.Vector2(size.width, size.height) },
                  thickness: { value: 2 },
                  length: { value: 32.0 },
                  margin: { value: 52.0 },
                  marginTop: { value: 52.0 },
                  marginBottom: { value: 52.0 },
                  edgeSoft: { value: 8.0 },
                  offset: { value: new THREE.Vector2(0.0, 0.0) },
                  opacity: { value: 0.98 },
              },
              vertexShader: `varying vec2 vUv; void main(){ vUv=position.xy*0.5+0.5; gl_Position=vec4(position.xy,0.0,1.0); }`,
              fragmentShader: `
        precision highp float;
        varying vec2 vUv;
        uniform vec2 resolution;
        uniform float thickness, length, margin, marginTop, marginBottom, opacity;
        uniform vec2 offset;
        float inRect(vec2 p, vec2 a, vec2 b){ vec2 s = step(a, p) * step(p, b); return s.x * s.y; }
        void main(){
          vec2 p = vUv * resolution + offset;
          float th = thickness, L = length, m = margin, mt = marginTop, mb = marginBottom;
          vec2 tl = vec2(m, resolution.y - mt), tr = vec2(resolution.x - m, resolution.y - mt);
          vec2 bl = vec2(m, mb), br = vec2(resolution.x - m, mb);
          float a = 0.0;
          a = max(a, inRect(p, vec2(tl.x, tl.y - th*0.5), vec2(tl.x + L, tl.y + th*0.5)));
          a = max(a, inRect(p, vec2(tl.x - th*0.5, tl.y - L), vec2(tl.x + th*0.5, tl.y)));
          a = max(a, inRect(p, vec2(tr.x - L, tr.y - th*0.5), vec2(tr.x, tr.y + th*0.5)));
          a = max(a, inRect(p, vec2(tr.x - th*0.5, tr.y - L), vec2(tr.x + th*0.5, tr.y)));
          a = max(a, inRect(p, vec2(bl.x, bl.y - th*0.5), vec2(bl.x + L, bl.y + th*0.5)));
          a = max(a, inRect(p, vec2(bl.x - th*0.5, bl.y), vec2(bl.x + th*0.5, bl.y + L)));
          a = max(a, inRect(p, vec2(br.x - L, br.y - th*0.5), vec2(br.x, br.y + th*0.5)));
          a = max(a, inRect(p, vec2(br.x - th*0.5, br.y), vec2(br.x + th*0.5, br.y + L)));
          if(a <= 0.0) discard;
          gl_FragColor = vec4(vec3(1.0), a * opacity);
        }
      `,
          });
          mat.toneMapped = !1;
          const mesh = new THREE.Mesh(geom, mat);
          mesh.frustumCulled = !1;
          mesh.renderOrder = 9999;
          scene.add(mesh);
          matRef.current = mat;
          return () => {
              scene.remove(mesh);
              try {
                  mat.dispose();
              } catch {}
              try {
                  geom.dispose();
              } catch {}
          };
      }, [scene]);
      useEffect(() => {
          const onPointer = (e) => {
              const rect = document.documentElement.getBoundingClientRect();
              const cx = rect.left + rect.width / 2;
              const cy = rect.top + rect.height / 2;
              const dx = e.clientX - cx;
              const dy = e.clientY - cy;
              const fx = -dx * 0.06;
              const fy = -dy * 0.03;
              if (matRef.current) matRef.current.uniforms.offset.value.set(fx, fy);
          };
          window.addEventListener("pointermove", onPointer, { passive: !0 });
          return () => window.removeEventListener("pointermove", onPointer);
      }, []);
      return null;
  }
  class Grid extends THREE.Group{
    constructor(canvas,camera,opts){ super();
      this.canvas=canvas; this.camera=camera; this.opts=opts;
      this.pointerUv=new THREE.Vector2(0.5,0.5);
      this.isPointerDown=false; this.isTouch=false;
      this.velocity=new THREE.Vector2(); this.offset=new THREE.Vector2();
      this.viewW=1; this.viewH=1; this._lastPX=null; this._lastPY=null;
      this.tiles=[]; this.bgTiles=[]; this.groups=[]; this.tileItems=[]; this.ray=new THREE.Raycaster();
      this.manageMode=false; this.onTileSelect=null; this.onTileClick=null;
      this._lastZ=this.camera.position.z;
      this.tileGeom=new THREE.PlaneGeometry(opts.tile,opts.tile,1,1);
      this.bgGeom=new THREE.PlaneGeometry(opts.tile,opts.tile,1,1);
      this.currentDragEase = opts.dragEase;
      this.hoverIdx=-1;
  
      this.downTime=0; this.downX=0; this.downY=0; this.longPressTimer=null; this.longPressFired=false;
  
      this.dragZoomStart = null;
      this.isDragging = false;
  
      this.pointerMap=new Map(); this.pinchDist0=null; this.cameraZ0=null;
      
      this.pinchAnimation = null;
      this.lastPinchTime = 0;
      this.pinchVelocity = 0;
      this.pinchSmoothingFactor = 0.8;
  
      this.layout();
  
      this.onPointerMove=this.onPointerMove.bind(this);
      this.onPointerDown=this.onPointerDown.bind(this);
      this.onPointerUp=this.onPointerUp.bind(this);
      this.onWheel=this.onWheel.bind(this);
      this.onContextMenu=this.onContextMenu.bind(this);
  
      canvas.addEventListener("pointermove",this.onPointerMove,{passive:false});
      canvas.addEventListener("pointerdown",this.onPointerDown,{passive:false});
      window.addEventListener("pointerup",this.onPointerUp,{passive:true});
      window.addEventListener("pointercancel",this.onPointerUp,{passive:true});
      canvas.addEventListener("wheel",this.onWheel,{passive:false});
      canvas.addEventListener("contextmenu",this.onContextMenu,{passive:false});
      
      canvas.addEventListener("touchstart", (e) => {
          if (e.touches.length >= 2) {
              e.preventDefault();
              e.stopPropagation();
          }
      }, {passive: false});
      
      canvas.addEventListener("touchmove", (e) => {
          if (e.touches.length >= 2) {
              e.preventDefault();
              e.stopPropagation();
          }
      }, {passive: false});
      
      document.addEventListener("touchstart", (e) => {
          if (e.touches.length >= 2) {
              e.preventDefault();
              e.stopPropagation();
              return false;
          }
      }, {passive: false});
      
      document.addEventListener("touchmove", (e) => {
          if (e.touches.length >= 2) {
              e.preventDefault();
              e.stopPropagation();
              return false;
          }
      }, {passive: false});
      
      document.addEventListener("gesturestart", (e) => {
          e.preventDefault();
          e.stopPropagation();
          return false;
      }, {passive: false});
      
      document.addEventListener("gesturechange", (e) => {
          e.preventDefault();
          e.stopPropagation();
          return false;
      }, {passive: false});
      
      document.addEventListener("gestureend", (e) => {
          e.preventDefault();
          e.stopPropagation();
          return false;
      }, {passive: false});
    }
    dispose(){
      this.canvas.removeEventListener("pointermove",this.onPointerMove);
      this.canvas.removeEventListener("pointerdown",this.onPointerDown);
      window.removeEventListener("pointerup",this.onPointerUp);
      window.removeEventListener("pointercancel",this.onPointerUp);
      this.canvas.removeEventListener("wheel",this.onWheel);
      this.canvas.removeEventListener("contextmenu",this.onContextMenu);
      this.tileGeom.dispose(); this.bgGeom.dispose();
      this.tiles.forEach(m=>m.material&&m.material.dispose());
      this.bgTiles.forEach(m=>m.material&&m.material.dispose());
    }
    setViewport(w,h){ this.viewW=w; this.viewH=h; }
    setManageMode(f){ this.manageMode=!!f; }
  
    layout(rowsOverride){
      const {cols, rows: rowsDefault, tile, gap} = this.opts;
      const rows = Math.max(1, Math.floor(rowsOverride || rowsDefault));
      const stepX = tile + gap, stepY = tile + gap;
      const sizeX = stepX * (cols - 1), sizeY = stepY * (rows - 1);
  
      if (this.groups && this.groups.length){
        this.groups.forEach(g=>{
          g.children.forEach(m=>{
            try{ if (m.material) m.material.dispose && m.material.dispose(); }catch(e){}
            try{ if (m.geometry) m.geometry.dispose && m.geometry.dispose(); }catch(e){}
          });
          try{ this.remove(g); }catch(e){}
        });
      }
  
      this.tiles = []; this.bgTiles = []; this.groups = []; this.tileItems = [];
  
      this.contentHalfW = sizeX/2 + tile/2;
      this.contentHalfH = sizeY/2 + tile/2;
  
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const x = c*stepX - sizeX/2;
          const y = sizeY/2 - r*stepY;
  
          const group = new THREE.Group();
          group.position.set(x,y,0);
  
          const bgMat = new THREE.MeshBasicMaterial({ color:0xffffff, transparent:true, opacity:0.0 });
          const bgMesh = new THREE.Mesh(this.bgGeom, bgMat);
          bgMesh.position.set(0,0,-0.0005);
  
          const imgMat = new THREE.MeshBasicMaterial({ color:0x000000, transparent:true, opacity:0.0 });
          const imgMesh = new THREE.Mesh(this.tileGeom, imgMat);
  
          group.add(bgMesh); group.add(imgMesh);
          this.add(group);
  
          this.groups.push(group);
          this.bgTiles.push(bgMesh);
          this.tiles.push(imgMesh);
          this.tileItems.push(null);
        }
      }
  }
  
    async loadAndApplyTexture(mesh, item, index){
      if (!item) {
        const oldMat = mesh.material;
        mesh.material = new THREE.MeshBasicMaterial({ color: 0x000000, transparent: true, opacity: 0.0 });
        oldMat?.dispose?.();
        return;
      }
  
      let texture;
      try {
        texture = await textureForItem(item);
      } catch (e) {
        console.warn(e);
        texture = makeEmptyTexture(); 
      }
  
      // OPTIMIZATION: Start transparent for fade, then lock it to opaque. 
      // This is safe because `makeCardCanvas` completely fills the bounds with a black background.
      const newMat = new THREE.MeshBasicMaterial({
        map: texture,
        transparent: true,
        opacity: 0.0
      });
  
      mesh.material?.dispose?.();
      mesh.material = newMat;
  
      gsap.to(newMat, {
        opacity: 1.0,
        duration: 0.6,
        delay: (index % this.opts.cols) * 0.03 + Math.floor(index / this.opts.cols) * 0.05,
        ease: "power2.out",
        onComplete: () => {
            if (newMat.opacity === 1.0) {
                // Remove transparency overhead once fully visible
                newMat.transparent = false;
                newMat.needsUpdate = true;
            }
        }
      });
    }
  
    setItems(items){
      const cols = this.opts.cols;
      const neededRows = Math.max(1, Math.ceil(items.length / cols));
  
      this.layout(neededRows);
  
      const total = this.tiles.length;
      for(let i = 0; i < total; i++){
        const item = i < items.length ? items[i] : null;
        this.tileItems[i] = item;
  
        if (!item){
          try{ if (this.tiles[i].material) this.tiles[i].material.dispose && this.tiles[i].material.dispose(); }catch(e){}
          this.tiles[i].material = new THREE.MeshBasicMaterial({ color:0x000000, transparent:true, opacity:0.0 });
          continue;
        }
  
        if (typeof this.loadAndApplyTexture === 'function'){
          try{ this.loadAndApplyTexture(this.tiles[i], item, i); }catch(e){ console.warn('Error applying texture to tile', e); }
        } else {
          try{ this.tiles[i].material.dispose && this.tiles[i].material.dispose(); }catch(e){}
          this.tiles[i].material = new THREE.MeshBasicMaterial({ color:0x222222, transparent:true, opacity:1.0 });
        }
      }
  }
  
    _pxToNorm(dx,dy){ const s=Math.min(this.viewW,this.viewH); return new THREE.Vector2(dx/s, dy/s); }
    _ndcFromClient(clientX, clientY){
      const rect=this.canvas.getBoundingClientRect();
      return { x: ((clientX-rect.left)/rect.width)*2-1, y: -((clientY-rect.top)/rect.height)*2+1 };
    }
    _hitTileAt(clientX, clientY){
      const ndc=this._ndcFromClient(clientX, clientY);
      this.ray.setFromCamera(ndc,this.camera);
      const hit=this.ray.intersectObjects(this.tiles,false)[0];
      if(!hit) return { idx:-1, mesh:null };
      const idx=this.tiles.indexOf(hit.object);
      return { idx, mesh:this.tiles[idx] };
    }
    _setHover(idx){
      if(this.hoverIdx===idx) return;
      if(this.hoverIdx>=0 && this.bgTiles[this.hoverIdx]){
        gsap.to(this.bgTiles[this.hoverIdx].material,{ opacity:0.0, duration:0.15, ease:"power2.out" });
      }
      this.hoverIdx=idx;
      if(idx>=0 && this.bgTiles[idx]){
        this.bgTiles[idx].material.color.set(0x000000);
        gsap.to(this.bgTiles[idx].material,{ opacity:0.2, duration:0.12, ease:"power2.out" });
      }
    }
    centerTileByIndex(idx, dur=0.7){
      if(idx<0||idx>=this.tiles.length) return;
      const p=this.groups[idx].position;
      gsap.to(this.offset, { x:-p.x, y:-p.y, duration:dur, ease:"power2.out" });
    }
    zoomToFitTile(idx, margin=1.25, dur=0.7){
      if(idx<0||idx>=this.tiles.length) return;
      this.centerTileByIndex(idx, dur*0.8);
      const tileSize = this.opts.tile * margin;
      const aspect = this.viewW / this.viewH;
      const fov = this.camera.fov * Math.PI/180;
      const neededHeight = tileSize * (aspect < 1 ? (1/aspect) : 1);
      const z = Math.max(CONFIG.zoomMin, Math.min(CONFIG.zoomMax, neededHeight / (2 * Math.tan(fov/2))));
      gsap.to(this.camera.position, { z, duration:dur, ease:"power2.out" });
    }
    _clampZ(z){ return Math.max(CONFIG.zoomMin, Math.min(CONFIG.zoomMax, z)); }

    onWheel(e){
      if(this.manageMode) return;
      e.preventDefault();
      this._externalZoomActive = false; 
      const cur = this.camera.position.z;
      const dz = e.deltaY * CONFIG.wheelScale * Math.max(0.6, cur);
      const target = this._clampZ(cur + dz);
      gsap.to(this.camera.position, { z: target, duration: 0.16, ease:"power2.out" });
    }
  
    onContextMenu(e){
        e.preventDefault();
        if(this.manageMode) return;
        
        if (e.pointerType !== 'touch') {
          gsap.to(this.offset, { x: 0, y: 0, duration: 0.6, ease:"power2.out" });
          gsap.to(this.camera.position, { z: CONFIG.zoomOut, duration: 0.6, ease:"power2.out" });
        }
      }
      _updatePointer(e) {
          if (e.pointerType === "touch") this.pointerMap.set(e.pointerId, { x: e.clientX, y: e.clientY });
      }
      _removePointer(e) {
          if (e.pointerType === "touch") {
              this.pointerMap.delete(e.pointerId);
              if (this.pointerMap.size < 2) {
                  this.pinchDist0 = null;
                  this.cameraZ0 = null;
                  this.pinchVelocity = 0;
                  if (this.pinchAnimation) {
                      this.pinchAnimation.kill();
                      this.pinchAnimation = null;
                  }
              }
          }
      }
      _twoTouchDistance() {
          const v = [...this.pointerMap.values()];
          if (v.length < 2) return null;
          const a = v[0],
              b = v[1];
          return Math.hypot(b.x - a.x, b.y - a.y);
      }
      onPointerMove(e) {
          if (e.pointerType === "touch") {
              e.preventDefault();
              e.stopPropagation();
          }
          
          const rect = this.canvas.getBoundingClientRect(),
              x = (e.clientX - rect.left) / rect.width,
              y = (e.clientY - rect.top) / rect.height;
          this.pointerUv.set(x, y);
          this._updatePointer(e);
          
          if (this.pointerMap.size >= 2) {
              return; 
          }
          if (this.isPointerDown) {
              if (!this.isDragging) {
                  const dist = Math.hypot(e.clientX - this.downX || 0, e.clientY - this.downY || 0);
                  const thresh = this.isTouch ? CONFIG.clickMovePxTouch : CONFIG.clickMovePx;
                  if (dist > thresh) {
                      this.isDragging = !0;
                      this.longPressFired = !0;
                      if (this.longPressTimer) {
                          window.clearTimeout(this.longPressTimer);
                          this.longPressTimer = null;
                      }
                      this.dragZoomStart = this.camera.position.z;
                      const targetZ = this._clampZ(this.dragZoomStart * 1.3);
                      gsap.to(this.camera.position, { z: targetZ, duration: 0.2, ease: "power2.out" });
                  }
              }
              const dx = this._lastPX === null ? 0 : e.clientX - this._lastPX,
                  dy = this._lastPY === null ? 0 : e.clientY - this._lastPY;
              this._lastPX = e.clientX;
              this._lastPY = e.clientY;
              const d = this._pxToNorm(dx, dy);
              const mult = this.isTouch ? CONFIG.dragMultTouch : CONFIG.dragMultMouse;
              this.offset.x += d.x * mult;
              this.offset.y += -d.y * mult;
              const lerpAmt = 1 - this.opts.velEase;
              this.velocity.lerp(new THREE.Vector2(d.x, -d.y), lerpAmt);
              if (this.isTouch) {
                const maxVel = 0.05;
                if (this.velocity.length() > maxVel) {
                  this.velocity.normalize().multiplyScalar(maxVel);
                }
              }
          } else {
              const hit = this._hitTileAt(e.clientX, e.clientY);
              this._setHover(hit.idx);
          }
      }
      onPointerDown(e) {
          if (e.pointerType === "touch") {
              e.preventDefault();
          }
          this.isPointerDown = !0;
          this.isTouch = e.pointerType === "touch";
          this.currentDragEase = this.isTouch ? CONFIG.touchDragEase : 0.3;
          this.canvas.classList.add("dragging");
          this._lastPX = e.clientX;
          this._lastPY = e.clientY;
          this.downTime = performance.now();
          this.downX = e.clientX;
          this.downY = e.clientY;
          this.longPressFired = !1;
          this.isDragging = !1;
          this.dragZoomStart = this.camera.position.z;

          const holdMs = this.isTouch ? CONFIG.longPressMsTouch : CONFIG.longPressMsMouse;
          
          if (this.longPressTimer) window.clearTimeout(this.longPressTimer);
          if (this.deletePressTimer) window.clearTimeout(this.deletePressTimer); 
          this.longPressTimer = null;
          this.deletePressTimer = null;

          this.longPressTimer = window.setTimeout(() => {
              const dist = Math.hypot(this._lastPX - this.downX || 0, this._lastPY - this.downY || 0);
              const thresh = this.isTouch ? CONFIG.clickMovePxTouch : CONFIG.clickMovePx;
              if (this.isPointerDown && dist <= thresh) {
                  const { idx } = this._hitTileAt(this._lastPX ?? this.downX, this._lastPY ?? this.downY);
                  if (idx >= 0) {
                      this.longPressFired = !0;
                      this.zoomToFitTile(idx, 1.25, 0.7);
                  }
              }
          }, holdMs);

          if (this.isTouch) {
              const deleteHoldMs = 2000;
              this.deletePressTimer = window.setTimeout(() => {
                  const dist = Math.hypot(this._lastPX - this.downX || 0, this._lastPY - this.downY || 0);
                  const thresh = CONFIG.clickMovePxTouch;
                  
                  if (this.isPointerDown && dist <= thresh && !this.longPressFired) {
                      const { idx } = this._hitTileAt(this._lastPX ?? this.downX, this._lastPY ?? this.downY);
                      
                      if (idx >= 0 && this.tileItems && this.tileItems[idx]) {
                          const item = this.tileItems[idx];
                          if (item && !item.placeholder) { 
                              this.longPressFired = !0; 
                              
                              const contentIndex = idx - 1; 
                              
                              if (contentIndex >= 0 && contentIndex < (this.tileItems.length - 2)) {
                                  const artist = item.title || item.artist || 'Item';
                                  const album = item.caption || item.album || '';
                                  
                                  if (navigator.vibrate) navigator.vibrate(50); 
                                  
                                  window.showDeleteConfirm(contentIndex, artist, album, window.deleteFromArchive);
                              }
                          }
                      }
                  }
              }, deleteHoldMs);
          }
      }
      onPointerUp(e) {
          this._removePointer(e);
          this.isPointerDown = !1;
          this.canvas.classList.remove("dragging");
          if (this.isDragging) {
              gsap.to(this.camera.position, { z: this.dragZoomStart, duration: 0.3, ease: "power2.out" });
              this.dragZoomStart = null;
              this.isDragging = !1;
              this.currentDragEase = this.opts.dragEase; 
          }
          const upTime = performance.now();
          const dt = upTime - this.downTime;
          const dist = Math.hypot(e.clientX - this.downX || 0, e.clientY - this.downY || 0);
          const thresh = this.isTouch ? CONFIG.clickMovePxTouch : CONFIG.clickMovePx;
          window.clearTimeout(this.longPressTimer);
          this.longPressTimer = null;
          if (
              !this.longPressFired &&
              dt < (this.isTouch ? CONFIG.longPressMsTouch : CONFIG.longPressMsMouse) &&
              dist <= thresh
          ) {
              const { idx } = this._hitTileAt(e.clientX, e.clientY);
              if (idx >= 0) {
                  this.centerTileByIndex(idx, 0.6);
                  this.onTileClick?.(idx, this.tileItems[idx] || null);
              }
          }
      }
      _visibleWorldWH() {
          const z = this.camera.position.z;
          const fov = this.camera.fov * Math.PI/180;
          const visH = 2 * Math.tan(fov / 2) * z;
          const visW = visH * (this.viewW / this.viewH);
          return { visW, visH };
      }
      _computeBounds() {
          const { visW, visH } = this._visibleWorldWH();
          const slack = CONFIG.boundSlack;
          const tooWide = visW >= this.contentHalfW * 2 + slack * 2;
          const tooTall = visH >= this.contentHalfH * 2 + slack * 2;
          const minX = tooWide ? 0 : visW / 2 - this.contentHalfW - slack;
          const maxX = tooWide ? 0 : this.contentHalfW + slack - visW / 2;
          const minY = tooTall ? 0 : visH / 2 - this.contentHalfH - slack;
          const maxY = tooTall ? 0 : this.contentHalfH + slack - visW / 2;
          return { minX, maxX, minY, maxY };
      }
      update() {
          const cursorOffset = this.pointerUv.clone().subScalar(0.5).multiplyScalar(-this.opts.ambient);
          if (!this.isPointerDown) {
              this.offset.add(this.velocity.clone().multiplyScalar(5));
              this.velocity.multiplyScalar(this.opts.velEase);
              const maxVel = this.isTouch ? 0.05 : 0.1;
              if (this.velocity.length() > maxVel) {
                this.velocity.normalize().multiplyScalar(maxVel);
              }
          }
          const tx = this.offset.x + cursorOffset.x,
              ty = this.offset.y - cursorOffset.y;

          this._updatePositionWithConstraints(tx, ty);
          
          const z = this.camera.position.z;
          if (Math.abs(z - (this._lastZ ?? z)) > 1e-3) {
              this._lastZ = z;
          }
      }
      resetPosition() {
          this.offset.set(0, 0);
          this.velocity.set(0, 0);
          this.pinchDist0 = null;
          this.cameraZ0 = null;
          this.pinchVelocity = 0;
          
          if (this.pinchAnimation) {
              this.pinchAnimation.kill();
              this.pinchAnimation = null;
          }
      }

      _applyRubberBand(value, min, max, rubber) {
          if (value < min) {
              const excess = min - value;
              return min - excess * rubber;
          } else if (value > max) {
              const excess = value - max;
              return max + excess * rubber;
          }
          return value;
      }

      _snapToGrid(value, gridSize, magnetStrength) {
          const snappedValue = Math.round(value / gridSize) * gridSize;
          const diff = snappedValue - value;
          const threshold = gridSize * magnetStrength;
          
          if (Math.abs(diff) < threshold) {
              return snappedValue;
          }
          return value;
      }

      _updatePositionWithConstraints(tx, ty) {
          const { minX, maxX, minY, maxY } = this._computeBounds();
          const ease = this.currentDragEase || this.opts.dragEase;
          
          if (!this.isPointerDown && !this.isDragging) {
              const gridSize = this.opts.tile + this.opts.gap;
              tx = this._snapToGrid(tx, gridSize, CONFIG.magnet);
              ty = this._snapToGrid(ty, gridSize, CONFIG.magnet);
          }
          
          if (this.isDragging) {
              tx = this._applyRubberBand(tx, minX, maxX, CONFIG.rubber);
              ty = this._applyRubberBand(ty, minY, maxY, CONFIG.rubber);
          } else {
              tx = Math.min(Math.max(tx, minX), maxX);
              ty = Math.min(Math.max(ty, minY), maxY);
          }
          
          this.position.x += (tx - this.position.x) * ease;
          this.position.y += (ty - this.position.y) * ease;
      }
  }
  function Postprocessing({ workgridState }) {
      const { gl, scene, camera, size } = useThree();
      const [mods, setMods] = useState(null);
      useEffect(() => {
          let cancelled = !1;
          (async () => {
              try {
                  const [{ EffectComposer }, { RenderPass }, { ShaderPass }, { OutputPass }] = await Promise.all([
                      import("https://esm.sh/three@0.160.1/examples/jsm/postprocessing/EffectComposer.js"),
                      import("https://esm.sh/three@0.160.1/examples/jsm/postprocessing/RenderPass.js"),
                      import("https://esm.sh/three@0.160.1/examples/jsm/postprocessing/ShaderPass.js"),
                      import("https://esm.sh/three@0.160.1/examples/jsm/postprocessing/OutputPass.js"),
                  ]);
                  if (!cancelled) setMods({ EffectComposer, RenderPass, ShaderPass, OutputPass });
              } catch (e) {
                  console.warn("Post FX unavailable", e);
              }
          })();
          return () => {
              cancelled = !0;
          };
      }, []);
      const { composer, shader } = useMemo(() => {
          if (!mods) return { composer: null, shader: null };
          try {
              const renderPass = new mods.RenderPass(scene, camera);
              const shader = new DistortionShader();
              const shaderPass = new mods.ShaderPass(shader);
              const outputPass = new mods.OutputPass();
              const composer = new mods.EffectComposer(gl);
              composer.addPass(renderPass);
              composer.addPass(shaderPass);
              composer.addPass(outputPass);
              return { composer, shader };
          } catch (e) {
              console.warn("Composer init failed", e);
              return { composer: null, shader: null };
          };
      }, [mods, gl, scene, camera]);
      useEffect(() => {
          if (!composer || !shader) return;
          const dpr = Math.min(2, gl.getPixelRatio?.() || 1.5);
          composer.setPixelRatio?.(dpr);
          composer.setSize(size.width, size.height);
          shader.update();
      }, [composer, shader, size, gl]);
      useEffect(() => {
          if (!shader) return;
          const base = workgridState === "INTRO" ? CONFIG.distortion.flat : CONFIG.distortion.curved;
          const scale = size.width < 800 ? 0.25 : 1.0;
          shader.setDistortion(base * scale);
      }, [workgridState, shader, size.width]);
      useFrame(() => {
          composer?.render();
      }, 1);
      return null;
  }
  function ProjectsGridPrimitive({ workgridState, items, onTileClick, controllerRef }) {
      const { gl, camera, size } = useThree();
      const grid = useMemo(
          () =>
              new Grid(gl.domElement, camera, {
                  cols: CONFIG.cols,
                  rows: CONFIG.rows,
                  tile: CONFIG.tile,
                  gap: CONFIG.gap,
                  ambient: CONFIG.ambient,
                  dragEase: CONFIG.dragEase,
                  velEase: CONFIG.velEase,
              }),
          [gl, camera]
      );
      useFrame(() => grid.update());
      useEffect(() => {
          grid.setViewport(size.width, size.height);
      }, [size, grid]);
      useEffect(() => {
          grid.onTileClick = onTileClick;
      }, [grid, onTileClick]);
      useEffect(() => {
          grid.setItems(items);
      }, [items, grid]);
      useEffect(() => {
          if (!controllerRef) return;
          controllerRef.current = {
              setZoom: (z) => {
                  grid._externalZoomActive = true;
                  const clamped = Math.max(CONFIG.zoomMin, Math.min(CONFIG.zoomMax, z));
                  gsap.to(camera.position, { 
                      z: clamped, 
                      duration: 0.12, 
                      ease: "power2.out",
                      onComplete: () => { grid._externalZoomActive = false; }
                  });
              },
          };
      }, [controllerRef, camera]);
      return React.createElement("primitive", { object: grid });
  }
  function GridView(props) {
      return React.createElement(
          Canvas,
          {
              gl: { antialias: !0, powerPreference: "high-performance" },
              camera: { fov: 35, position: [0, 0, CONFIG.zoomOut] },
              dpr: [1, 2],
              onCreated: ({ gl }) => {
                  gl.setClearColor(0x000000, 1);
                  gl.outputColorSpace = THREE.SRGBColorSpace;
                  gl.toneMapping = THREE.NoToneMapping;
              },
          },
          React.createElement("ambientLight", { intensity: 1 }),
          React.createElement("directionalLight", { intensity: 0.7, position: [2, 3, 4] }),
          React.createElement(ProjectsGridPrimitive, props),
          React.createElement(BracketOverlay, null),
          React.createElement(Postprocessing, { workgridState: props.workgridState })
      );
  }
  function useCamera() {
      const videoRef = useRef(null),
          streamRef = useRef(null),
          [error, setError] = useState("");
      const isHttps = () => location.protocol === "https:" || location.hostname === "localhost";
      const stop = () => {
          streamRef.current?.getTracks?.().forEach((t) => t.stop());
          streamRef.current = null;
          if (videoRef.current) videoRef.current.srcObject = null;
      };
      const start = async () => {
          setError("");
          if (!isHttps()) {
              setError("Camera requires HTTPS (or localhost). Use Import instead.");
              return !1;
          }
          const v = videoRef.current;
          if (!v) {
              setError("Camera function coming soon! xoxo");
              return !1;
          }
          try {
              v.setAttribute("playsinline", "");
              v.setAttribute("autoplay", "");
              v.setAttribute("muted", "");
              v.playsInline = !0;
              v.muted = !0;
              const constraints = {
                  video: { facingMode: { ideal: "environment" }, width: { ideal: 1920 }, height: { ideal: 1080 } },
                  audio: !1,
              };
              const stream = await navigator.mediaDevices.getUserMedia(constraints);
              streamRef.current = stream;
              v.srcObject = stream;
              await new Promise((res) => {
                  const onReady = () => {
                      v.removeEventListener("loadedmetadata", onReady);
                      res();
                  };
                  v.addEventListener("loadedmetadata", onReady);
              });
              await v.play().catch(() => {});
              return !0;
          } catch (e) {
              console.warn("Camera error:", e);
              let msg = "Camera unavailable.";
              if (e?.name === "NotAllowedError") {
                  msg = "Camera permission denied. Check browser permissions.";
              }
              if (e?.name === "NotFoundError") {
                  msg = "No suitable camera found.";
              }
              if (e?.name === "OverconstrainedError") {
                  msg = "Camera constraints not supported on this device.";
              }
              setError(msg);
              stop();
              return !1;
          }
      };
      return { videoRef, start, stop, error };
  }
  async function exportCardPNGFromCanvas(sourceCanvas, title, caption, gps = "") {
      const img = await new Promise((res, rej) => {
          const im = new Image();
          im.onload = () => res(im);
          im.onerror = rej;
          im.src = sourceCanvas.toDataURL("image/png");
      });
      const cnv = makeCardCanvas({ img, title, caption, gps, ts: nowTS() });
      return new Promise((resolve) => {
          cnv.toBlob(
              (b) => {
                  const url = URL.createObjectURL(b);
                  resolve({ url, blob: b });
              },
              "image/png",
              0.96
          );
      });
  }
  function Leveler() {
      const [enabled, setEnabled] = useState(!1);
      const [deg, setDeg] = useState(0);
      useEffect(() => {
          if (!enabled) return;
          const onOrient = (e) => {
              const g = typeof e.gamma === "number" ? e.gamma : 0;
              const clamped = Math.max(-45, Math.min(45, g));
              setDeg(clamped);
          };
          window.addEventListener("deviceorientation", onOrient, !0);
          return () => window.removeEventListener("deviceorientation", onOrient, !0);
      }, [enabled]);
      const good = Math.abs(deg) <= 2;
      const xPct = ((deg + 45) / 90) * 100;
      const needPermission =
          typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function";
      const askPermission = async () => {
          try {
              if (needPermission) {
                  const st = await DeviceOrientationEvent.requestPermission();
                  if (st === "granted") setEnabled(!0);
              } else {
                  setEnabled(!0);
              }
          } catch {}
      };
      return React.createElement(
          "div",
          { className: `leveler ${good ? "good" : ""}` },
          React.createElement("div", { className: "vial" }),
          React.createElement("div", { className: "bubble", style: { "--bubble-x": `${xPct}%` } }),
          React.createElement("div", { className: "deg" }, `${deg.toFixed(1)}°`),
          !enabled && React.createElement("button", { className: "enable", onClick: askPermission }, "Enable leveler")
      );
  }

  
  function OverlayFlow({ open, onClose, onAddToArchive }) {
      const [step, setStep] = useState(0),
          [title, setTitle] = useState(""),
          [caption, setCaption] = useState("A quick visual note");
      const [reviewCanvas, setReviewCanvas] = useState(null),
          [exporting, setExporting] = useState(!1);
      const camera = useCamera();
      const filePickRef = useRef(null);
      const sheetRef = useRef(null);
      const reviewMountRef = useRef(null);
      useEffect(() => {
          const mount = reviewMountRef.current;
          if (!mount) return;
          while (mount.firstChild) mount.removeChild(mount.firstChild);
          if (reviewCanvas && step === 2) {
              reviewCanvas.style.width = "100%";
              reviewCanvas.style.height = "auto";
              reviewCanvas.style.display = "block";
              mount.appendChild(reviewCanvas);
          }
      }, [reviewCanvas, step]);
      useEffect(() => {
          if (!open) {
              camera.stop();
              setStep(0);
              setTitle("");
              setCaption("A quick visual note");
              setReviewCanvas(null);
              setExporting(!1);
          }
      }, [open]);
      const startCamera = async () => {
          const ok = await camera.start();
          setStep(ok ? 1 : 0);
      };
      const captureShot = () => {
          const v = camera.videoRef.current;
          if (!v || !v.videoWidth) {
              return;
          }
          const vw = v.videoWidth,
              vh = v.videoHeight,
              s = Math.min(vw, vh),
              sx = Math.floor((vw - s) / 2),
              sy = Math.floor((vh - s) / 2);
          const c = document.createElement("canvas");
          c.width = s;
          c.height = s;
          const ctx = c.getContext("2d");
          ctx.drawImage(v, sx, sy, s, s, 0, 0, s, s);
          setReviewCanvas(c);
          setStep(2);
      };
      const pickFile = () => filePickRef.current?.click();
      const onFileChange = (e) => {
          const f = e.target.files?.[0];
          if (!f) return;
          const img = new Image();
          const url = URL.createObjectURL(f);
          img.onload = () => {
              const s = Math.min(img.width, img.height),
                  sx = Math.floor((img.width - s) / 2),
                  sy = Math.floor((img.height - s) / 2);
              const c = document.createElement("canvas");
              c.width = s;
              c.height = s;
              c.getContext("2d").drawImage(img, sx, sy, s, s, 0, 0, s, s);
              URL.revokeObjectURL(url);
              setReviewCanvas(c);
              setStep(2);
          };
          img.src = url;
      };
      const doExport = async () => {
          if (!reviewCanvas) return;
          setExporting(!0);
          const { url } = await exportCardPNGFromCanvas(reviewCanvas, title || "[ title ]", caption || "—");
          setExporting(!1);
          setStep(5);
          onAddToArchive?.({
              id: "note_" + Date.now(),
              src: url,
              title: title || "[ title ]",
              caption: caption || "—",
              baked: !0,
              ts: nowTS(),
              createdMs: Date.now(),
          });
      };
      if (!open) return null;
      return React.createElement(
          "div",
          { className: "overlay open curved" },
          React.createElement(
              "div",
              { className: "sheet", ref: sheetRef, role: "dialog", "aria-modal": "true" },
              React.createElement(
                  "div",
                  { className: "titlebar" },
                  React.createElement(
                      "h2",
                      null,
                      ["Start", "Viewfinder", "Review", "Details", "Export", "Done"][step] || "Start"
                  ),
                  React.createElement("button", { className: "btn ghost", onClick: onClose }, "ESC")
              ),
              step === 0 &&
                  React.createElement(
                      "div",
                      { className: "grid", style: { alignContent: "center" } },
                      camera.error
                          ? React.createElement(
                                "div",
                                { className: "hint", style: { color: "#ffb4b4" } },
                                camera.error
                            )
                          : null,
                      React.createElement(
                          "div",
                          { className: "grid cols-2" },
                          React.createElement(
                              "button",
                              { className: "btn primary", onClick: startCamera },
                              "Open Camera"
                          ),
                          React.createElement("button", { className: "btn", onClick: pickFile }, "Import Photo")
                      ),
                      React.createElement("input", {
                          ref: filePickRef,
                          type: "file",
                          accept: "image/*",
                          style: { display: "none" },
                          onChange: onFileChange,
                      })
                  ),
              step === 1 &&
                  React.createElement(
                      React.Fragment,
                      null,
                      React.createElement(
                          "div",
                          { className: "vf chrome-frame" },
                          React.createElement("video", {
                              ref: camera.videoRef,
                              playsInline: !0,
                              autoPlay: !0,
                              muted: !0,
                          }),
                          React.createElement("span", { className: "perfs", "aria-hidden": "true" }),
                          React.createElement(Leveler, null)
                      ),
                      React.createElement(
                          "div",
                          { className: "row", style: { marginTop: "12px", justifyContent: "space-between" } },
                          React.createElement(
                              "button",
                              {
                                  className: "btn",
                                  onClick: () => {
                                      camera.stop();
                                      setStep(0);
                                  },
                              },
                              "Back"
                          ),
                          React.createElement("button", { className: "btn primary", onClick: captureShot }, "Capture")
                      )
                  ),
              step === 2 &&
                  React.createElement(
                      React.Fragment,
                      null,
                      React.createElement("div", { className: "preview chrome-frame", ref: reviewMountRef }),
                      React.createElement(
                          "div",
                          { className: "row", style: { marginTop: "12px", justifyContent: "space-between" } },
                          React.createElement(
                              "button",
                              {
                                  className: "btn",
                                  onClick: () => {
                                      camera.stop();
                                      setStep(1);
                                  },
                              },
                              "Retake"
                          ),
                          React.createElement(
                              "button",
                              { className: "btn primary", onClick: () => setStep(3) },
                              "Keep"
                          )
                      )
                  ),
              step === 3 &&
                  React.createElement(
                      "div",
                      { className: "grid" },
                      React.createElement("label", { className: "label", htmlFor: "t" }, "Title (40 cap)"),
                      React.createElement("input", {
                          id: "t",
                          maxLength: 40,
                          className: "input",
                          value: title,
                          onChange: (e) => setTitle(e.target.value),
                      }),
                      React.createElement("label", { className: "label", htmlFor: "c" }, "Note (100 cap)"),
                      React.createElement("textarea", {
                          id: "c",
                          maxLength: 100,
                          className: "textarea",
                          value: caption,
                          onChange: (e) => setCaption(e.target.value),
                      }),
                      React.createElement(
                          "div",
                          { className: "row", style: { marginTop: "6px", justifyContent: "space-between" } },
                          React.createElement("button", { className: "btn", onClick: () => setStep(2) }, "Back"),
                          React.createElement(
                              "button",
                              { className: "btn primary", onClick: () => setStep(4) },
                              "Next"
                          )
                      )
                  ),
              step === 4 &&
                  React.createElement(
                      "div",
                      { className: "grid" },
                      React.createElement(
                          "div",
                          { className: "hint" },
                          "Export generates a 1:1 card PNG and adds it to the archive."
                      ),
                      React.createElement(
                          "div",
                          { className: "row", style: { justifyContent: "space-between" } },
                          React.createElement("button", { className: "btn", onClick: () => setStep(3) }, "Back"),
                          React.createElement(
                              "button",
                              { className: "btn primary", disabled: exporting, onClick: doExport },
                              exporting ? "Exporting…" : "Export PNG & Save"
                          )
                      )
                  ),
              step === 5 &&
                  React.createElement(
                      "div",
                      { className: "grid", style: { placeItems: "center", textAlign: "center" } },
                      React.createElement(
                          "div",
                          { className: "row", style: { justifyContent: "center" } },
                          React.createElement(
                              "button",
                              {
                                  className: "btn",
                                  onClick: () => {
                                      setStep(0);
                                      setTitle("");
                                      setCaption("A quick visual note");
                                      setReviewCanvas(null);
                                  },
                              },
                              "intoview:note"
                          )
                      ),
                      React.createElement(
                          "div",
                          { className: "row", style: { justifyContent: "center" } },
                          React.createElement("button", { className: "btn primary", onClick: onClose }, "ESC")
                      )
                  )
          )
      );
  }
  function HelpOverlay({ open, onClose }) {
      if (!open) return null;
      const containerRef = useRef(null);
      useEffect(() => {
          const container = containerRef.current;
          if (!container) return;
          function initSpotlight(container) {
              if (!container) return;
              container.style.setProperty("--mouse-x", "50%");
              container.style.setProperty("--mouse-y", "50%");
              const onPointerMove = (e) => {
                  const el = document.elementFromPoint(e.clientX, e.clientY);
                  const detailsEl = el && el.closest("details");
                  if (!detailsEl) return;
                  const rect = detailsEl.getBoundingClientRect();
                  const x = e.clientX - rect.left;
                  const y = e.clientY - rect.top;
                  detailsEl.style.setProperty("--mouse-x", `${x}px`);
                  detailsEl.style.setProperty("--mouse-y", `${y}px`);
                  container.style.setProperty("--mouse-x", `${e.clientX}px`);
                  container.style.setProperty("--mouse-y", `${e.clientY}px`);
              };
              container.addEventListener("pointermove", onPointerMove, { passive: !0 });
              const detailsElements = container.querySelectorAll("details");
              const onPointerLeave = (e) => {
                  e.currentTarget.style.setProperty("--mouse-x", "50%");
                  e.currentTarget.style.setProperty("--mouse-y", "50%");
              };
              detailsElements.forEach((d) => {
                  d.addEventListener("pointerleave", onPointerLeave);
              });
              return () => {
                  container.removeEventListener("pointermove", onPointerMove);
                  detailsElements.forEach((d) => {
                      d.removeEventListener("pointerleave", onPointerLeave);
                  });
              };
          }
          const helpDisclosure = container.querySelector("#help-disclosure");
          const faqDisclosure = container.querySelector("#faq-disclosure");
          const cleanupHelp = initSpotlight(helpDisclosure);
          const cleanupFaq = initSpotlight(faqDisclosure);
          return () => {
              cleanupHelp?.();
              cleanupFaq?.();
          };
      }, [containerRef.current]);
      return React.createElement(
          "div",
          { className: "overlay open curved" },
          React.createElement(
              "div",
              { className: "sheet", role: "dialog", "aria-modal": "true", style: { maxWidth: "1200px" } },
              React.createElement(
                  "div",
                  { className: "titlebar" },
                  React.createElement("h2", null, "Info"),
                  React.createElement("button", { className: "btn ghost", onClick: onClose }, "Close")
              ),
              React.createElement(
                  "div",
                  { className: "container", ref: containerRef, style: { overflowY: "auto", padding: "1rem" } },
                  React.createElement(
                      "div",
                      { className: "section" },
                      React.createElement("h2", { className: "section-title" }, "Help & Controls"),
                      React.createElement(
                          "div",
                          { className: "morphing-disclosure", id: "help-disclosure" },
                          React.createElement(
                              "details",
                              { name: "help" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.25a.75.75 0 001 .707A8.237 8.237 0 016 18.75c1.995 0 3.823.707 5.25 1.886V4.533zM12.75 20.636A8.214 8.214 0 0118 18.75c.966 0 1.89.166 2.75.47a.75.75 0 001-.708V4.262a.75.75 0 00-.5-.707A9.735 9.735 0 0018 3a9.707 9.707 0 00-5.25 1.533v16.103z",
                                      })
                                  ),
                                  React.createElement("span", null, "Navigation"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      React.createElement("strong", null, "Mouse:"),
                                      " Drag to pan • Wheel to zoom • Click tile to center • Long-press tile to fit view • Right-click to reset"
                                  ),
                                  React.createElement(
                                      "p",
                                      null,
                                      React.createElement("strong", null, "Touch:"),
                                      " Drag to pan • Pinch to zoom • Tap tile to center • Long-press tile to fit"
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "help" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M2.25 6a3 3 0 013-3h13.5a3 3 0 013 3v12a3 3 0 01-3 3H5.25a3 3 0 01-3-3V6zm3.97.97a.75.75 0 011.06 0l2.25 2.25a.75.75 0 010 1.06l-2.25 2.25a.75.75 0 01-1.06-1.06l1.72-1.72-1.72-1.72a.75.75 0 010-1.06zm4.28 4.28a.75.75 0 000 1.5h5.25a.75.75 0 000-1.5H10.5z",
                                          clipRule: "evenodd",
                                      })
                                  ),
                                  React.createElement("span", null, "Keyboard Shortcuts"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      React.createElement("kbd", null, "1"),
                                      " Flat distortion • ",
                                      React.createElement("kbd", null, "2"),
                                      " Curved distortion • ",
                                      React.createElement("kbd", null, "0"),
                                      " Reset view"
                                  ),
                                  React.createElement(
                                      "p",
                                      null,
                                      React.createElement("kbd", null, "N"),
                                      " New note • ",
                                      React.createElement("kbd", null, "?"),
                                      " or ",
                                      React.createElement("kbd", null, "H"),
                                      " Help dialog"
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "help" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z",
                                          clipRule: "evenodd",
                                      })
                                  ),
                                  React.createElement("span", null, "View Controls"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "Toggle between ",
                                      React.createElement("strong", null, "Grid View"),
                                      " (default spatial layout) and ",
                                      React.createElement("strong", null, "List View"),
                                      " using the buttons in the left sidebar."
                                  ),
                                  React.createElement(
                                      "p",
                                      null,
                                      "Use ",
                                      React.createElement("strong", null, "Zoom Presets"),
                                      " (25%, 50%, 75%) for quick framing adjustments."
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "help" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z",
                                      }),
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M9.344 3.071a49.52 49.52 0 015.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 01-3 3h-15a3 3 0 01-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 001.11-.71l.822-1.315a2.942 2.942 0 012.332-1.39zM6.75 12.75a5.25 5.25 0 1110.5 0 5.25 5.25 0 01-10.5 0zm12-1.5a.75.75 0 100-1.5.75.75 0 000 1.5z",
                                          clipRule: "evenodd",
                                      })
                                  ),
                                  React.createElement("span", null, "Camera & Leveler"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "The ",
                                      React.createElement("strong", null, "leveler"),
                                      ' appears on the Viewfinder step when creating a new note. Tap "Enable leveler" to use device orientation for perfect horizontals.'
                                  ),
                                  React.createElement(
                                      "p",
                                      null,
                                      "Requires ",
                                      React.createElement("strong", null, "HTTPS"),
                                      " (or localhost) and device permission."
                                  )
                              )
                          )
                      )
                  ),
                  React.createElement(
                      "div",
                      { className: "section" },
                      React.createElement("h2", { className: "section-title" }, "FAQ"),
                      React.createElement(
                          "div",
                          { className: "morphing-disclosure", id: "faq-disclosure" },
                          React.createElement(
                              "details",
                              { name: "faq" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M12 2a10 10 0 100 20 10 10 0 000-20zm1 15h-2v-2h2v2zm1.07-7.75l-.9.92A3.49 3.49 0 0112 12.5h-1v-1h1c.28 0 .5-.22.5-.5 0-.13-.05-.26-.14-.36l-.8-.8A2 2 0 0113 6.5a2 2 0 012 2c0 .55-.22 1.05-.58 1.5z",
                                      })
                                  ),
                                  React.createElement("span", null, "What is intoview?"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      React.createElement("strong", null, "intoview.pro"),
                                      ' is a curated platform and toolkit for creators ~ {designers, developers, and makers} ~ to present high-impact work in context rather than as a traditional résumé. It’s focused on "showing" instead of as "listing": visual, interactive snapshots that communicate influence, intent, and outcomes.'
                                  ),
                                  React.createElement(
                                      "p",
                                      { className: "note-meta" },
                                      React.createElement("span", null, "🔗 brand: intoview.pro"),
                                      React.createElement("span", null, "🧭 focus: discovery & framing")
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "faq" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M3 6a1 1 0 011-1h16a1 1 0 011 1v11a1 1 0 01-1 1H4a1 1 0 01-1-1V6z",
                                      })
                                  ),
                                  React.createElement("span", null, "What's behind intoview?"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "My workflow blends quick iteration and storytelling: identify → deliberate → iterate → deliver impact through ideation."
                                  ),
                                  React.createElement(
                                      "p",
                                      { className: "note-meta" },
                                      React.createElement(
                                          "span",
                                          null,
                                          "🛠️ methods: rapid prototyping, documentation dulls ideation"
                                      ),
                                      React.createElement("span", null, "⚡ #vibecheck")
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "faq" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", { d: "M12 6a6 6 0 100 12 6 6 0 000-12z" })
                                  ),
                                  React.createElement("span", null, "What is intoview for?"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "Right now I’m using intoview.pro as a digital sandbox for {visual design exploration, tech-stack familiarity, and practical storytelling}."
                                  ),
                                  React.createElement(
                                      "p",
                                      { className: "note-meta" },
                                      React.createElement("span", null, "📦 current: prototypes & workflows"),
                                      React.createElement("span", null, "🔁 iteration cadence: frequent")
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "faq" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M6 3h12l2 4H4l2-4zM4 9h16v9a2 2 0 01-2 2H6a2 2 0 01-2-2V9z",
                                      })
                                  ),
                                  React.createElement("span", null, "How do I bring my best ... intoview?"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "intoview.pro was once just a concept; one that was completely torn down and built anew. This identiy {brand} offers me an environment and platform through which I further my craft. If you want a real case study, this is one in motion."
                                  ),
                                  React.createElement(
                                      "p",
                                      { className: "note-meta" },
                                      React.createElement("span", null, "🎯 Google the word: Kaizen")
                                  )
                              )
                          ),
                          React.createElement(
                              "details",
                              { name: "faq" },
                              React.createElement(
                                  "summary",
                                  null,
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          d: "M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7z",
                                      })
                                  ),
                                  React.createElement("span", null, "Insights/Outlook"),
                                  React.createElement(
                                      "svg",
                                      {
                                          xmlns: "http://www.w3.org/2000/svg",
                                          viewBox: "0 0 24 24",
                                          fill: "currentColor",
                                      },
                                      React.createElement("path", {
                                          fillRule: "evenodd",
                                          d: "M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z",
                                          clipRule: "evenodd",
                                      })
                                  )
                              ),
                              React.createElement(
                                  "div",
                                  { className: "content" },
                                  React.createElement(
                                      "p",
                                      null,
                                      "Ideally, intoview becomes the lightweight, default way makers show their best, most current work — an ecosystem of short-form, interactive artifacts people can easily discover, remix, and use in conversations, applications, and portfolios. Also, ideally, I find myself working somewhere building real things for real people."
                                  ),
                                  React.createElement(
                                      "p",
                                      { className: "note-meta" },
                                      React.createElement("span", null, "🚀 aspiration: Think. Make. Walk my dog.")
                                  )
                              )
                          )
                      )
                  )
              )
          )
      );
  }
  function ZoomPresets({ zoom, onSetZoom }) {
      const presets = [
          { label: "75%", zoomZ: 0.75, title: "Tight View (75% Preset)" },
          { label: "50%", zoomZ: 1.5, title: "Default View (50% Preset)" },
          { label: "25%", zoomZ: 2.5, title: "Wide View (25% Preset)" },
      ];
      const activeLabel = presets.reduce(
          (active, preset) => (Math.abs(zoom - preset.zoomZ) < 0.2 ? preset.label : active),
          null
      );
      return React.createElement(
          "div",
          { className: "zoom-presets", "aria-label": "Grid Zoom Presets" },
          presets.map((p) =>
              React.createElement(
                  "button",
                  {
                      key: p.label,
                      className: `zoom-presets-btn ${p.label === activeLabel ? "active" : ""}`,
                      title: p.title,
                      onClick: () => onSetZoom(p.zoomZ),
                  },
                  p.label
              )
          )
      );
  }
  // ─── Detect coarse pointer (touch) once ────────────────────────────────────
  const isCoarsePointer = () => window.matchMedia("(pointer: coarse)").matches;

  // ─── Desktop inline-editable cell ──────────────────────────────────────────
  function EditableCell({ value, className, editable, onCommit, placeholder }) {
    const [editing, setEditing] = React.useState(false);
    const [draft, setDraft] = React.useState(value);
    const inputRef = React.useRef(null);
    // Track whether a button tap is in progress so blur doesn't race it
    const committingRef = React.useRef(false);

    React.useEffect(() => { if (!editing) setDraft(value); }, [value, editing]);

    const activate = (e) => {
      if (!editable || isCoarsePointer()) return;
      e.stopPropagation();
      setDraft(value);
      setEditing(true);
      requestAnimationFrame(() => {
        inputRef.current?.focus();
        inputRef.current?.select();
      });
    };

    const commit = () => {
      if (committingRef.current) return;
      committingRef.current = true;
      const trimmed = draft.trim();
      if (trimmed && trimmed !== value) onCommit(trimmed);
      setEditing(false);
      requestAnimationFrame(() => { committingRef.current = false; });
    };

    const cancel = () => {
      committingRef.current = true;
      setDraft(value);
      setEditing(false);
      requestAnimationFrame(() => { committingRef.current = false; });
    };

    const onKeyDown = (e) => {
      if (e.key === "Enter") { e.preventDefault(); commit(); }
      else if (e.key === "Escape") { e.preventDefault(); cancel(); }
      e.stopPropagation();
    };

    if (editing) {
      return React.createElement(
        "span",
        { className: `${className} editing-cell`, onClick: (e) => e.stopPropagation() },
        React.createElement("input", {
          ref: inputRef,
          className: "cell-input",
          value: draft,
          onChange: (e) => setDraft(e.target.value),
          onKeyDown,
          onBlur: () => { if (!committingRef.current) commit(); },
          placeholder: placeholder || value,
          "aria-label": `Edit ${placeholder}`,
          autoComplete: "off",
          autoCorrect: "off",
          spellCheck: false,
        }),
        React.createElement(
          "span",
          { className: "cell-actions" },
          React.createElement("button", {
            className: "cell-action-btn cell-confirm",
            onMouseDown: (e) => { e.preventDefault(); commit(); },
            title: "Save (Enter)",
            "aria-label": "Save",
          }, "✓"),
          React.createElement("button", {
            className: "cell-action-btn cell-cancel",
            onMouseDown: (e) => { e.preventDefault(); cancel(); },
            title: "Cancel (Esc)",
            "aria-label": "Cancel",
          }, "✕")
        )
      );
    }

    return React.createElement(
      "span",
      {
        className: `${className}${editable ? " editable-cell" : ""}`,
        onClick: editable ? activate : undefined,
        title: editable && !isCoarsePointer() ? "Click to edit" : undefined,
      },
      value || placeholder || "—",
      editable && !isCoarsePointer() && React.createElement(
        "span", { className: "edit-pencil", "aria-hidden": "true" },
        React.createElement("svg", { viewBox: "0 0 16 16", fill: "none", stroke: "currentColor", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("path", { d: "M11.5 2.5l2 2-7 7-2.5.5.5-2.5 7-7z" })
        )
      )
    );
  }

  // ─── Mobile expanded-row editor ────────────────────────────────────────────
  function MobileEditPanel({ item, onCommit, onCancel }) {
    const [titleDraft, setTitleDraft] = React.useState(item.title || "");
    const [captionDraft, setCaptionDraft] = React.useState(item.caption || "");
    const panelRef = React.useRef(null);
    const titleRef = React.useRef(null);

    React.useEffect(() => {
      // Scroll row into view then focus title field
      if (panelRef.current) {
        const row = panelRef.current.closest(".project-item");
        if (row) {
          // Small delay lets the DOM expand first
          setTimeout(() => {
            row.scrollIntoView({ behavior: "smooth", block: "center" });
            titleRef.current?.focus();
          }, 80);
        }
      }
    }, []);

    const handleSave = (e) => {
      e && e.preventDefault();
      onCommit({
        title: titleDraft.trim() || item.title,
        caption: captionDraft.trim() || item.caption,
      });
    };

    const onKeyDown = (e) => {
      if (e.key === "Enter" && e.ctrlKey) handleSave(e);
      if (e.key === "Escape") onCancel();
      e.stopPropagation();
    };

    return React.createElement(
      "div",
      { className: "mobile-edit-panel", ref: panelRef, onClick: (e) => e.stopPropagation() },
      React.createElement(
        "div", { className: "mobile-edit-field" },
        React.createElement("span", { className: "mobile-edit-label" }, "Title"),
        React.createElement("input", {
          ref: titleRef,
          className: "mobile-edit-input title-input",
          value: titleDraft,
          onChange: (e) => setTitleDraft(e.target.value),
          onKeyDown,
          placeholder: "Title",
          "aria-label": "Edit title",
          autoComplete: "off",
          autoCorrect: "on",
          spellCheck: true,
          enterKeyHint: "next",
        })
      ),
      React.createElement(
        "div", { className: "mobile-edit-field" },
        React.createElement("span", { className: "mobile-edit-label" }, "Caption"),
        React.createElement("input", {
          className: "mobile-edit-input",
          value: captionDraft,
          onChange: (e) => setCaptionDraft(e.target.value),
          onKeyDown,
          placeholder: "Caption",
          "aria-label": "Edit caption",
          autoComplete: "off",
          autoCorrect: "on",
          spellCheck: true,
          enterKeyHint: "done",
          onKeyPress: (e) => { if (e.key === "Enter") handleSave(e); },
        })
      ),
      React.createElement(
        "div", { className: "mobile-edit-actions" },
        React.createElement("button", {
          className: "mobile-edit-save",
          onClick: handleSave,
          "aria-label": "Save changes",
        }, "Save"),
        React.createElement("button", {
          className: "mobile-edit-discard",
          onClick: (e) => { e.stopPropagation(); onCancel(); },
          "aria-label": "Cancel editing",
        }, "Cancel")
      )
    );
  }

  function ListView({ items, onUpdateItem }) {
  const bgRef = useRef(null);
  const containerRef = useRef(null);
  const [activeIdx, setActiveIdx] = useState(-1);
  const [mobileEditIdx, setMobileEditIdx] = useState(-1);
  const mouse = useRef({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
  const bgPos = useRef({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
  const scrollY = useRef(0);
  const isTouch = isCoarsePointer();

  useEffect(() => {
    const root = containerRef.current?.closest('.listview-root');
    if(!root) return;
    const move = (e) => { mouse.current.x = e.clientX; mouse.current.y = e.clientY; };
    const onScroll = (e) => { scrollY.current = e.target.scrollTop; };
    window.addEventListener("pointermove", move, { passive: true });
    root.addEventListener("scroll", onScroll, { passive: true });
    scrollY.current = root.scrollTop;
    return () => {
        window.removeEventListener("pointermove", move);
        root.removeEventListener("scroll", onScroll);
    };
  }, []);

  useEffect(() => {
    const bg = bgRef.current;
    if (!bg) return;
    const update = () => {
      const targetY = mouse.current.y + scrollY.current;
      const targetX = mouse.current.x;
      bgPos.current.x += (targetX - bgPos.current.x) * 0.12;
      bgPos.current.y += (targetY - bgPos.current.y) * 0.12;
      gsap.set(bg, { x: bgPos.current.x, y: bgPos.current.y, xPercent: -50, yPercent: -50, force3D: true });
    };
    gsap.ticker.add(update);
    return () => gsap.ticker.remove(update);
  }, []);

  useEffect(() => {
    const container = containerRef.current;
    if (!container) return;
    const onLeave = () => {
      if (mobileEditIdx === -1) {
        setActiveIdx(-1);
        const bg = bgRef.current;
        if (bg) gsap.to(bg, { opacity: 0, scale: 1.05, duration: 0.6, ease: "power2.inOut" });
        container.classList.remove("has-active");
      }
    };
    container.addEventListener("mouseleave", onLeave);
    return () => container.removeEventListener("mouseleave", onLeave);
  }, [mobileEditIdx]);

  const onEnterRow = (idx, imageUrl) => {
    if (isTouch) return; // no hover imagery on touch
    setActiveIdx(idx);
    containerRef.current?.classList.add("has-active");
    const bg = bgRef.current;
    if (!bg) return;
    bg.style.backgroundImage = `url(${imageUrl})`;
    gsap.set(bg, { opacity: 0, scale: 1.2, transformOrigin: "center center" });
    gsap.to(bg, { opacity: 0.65, scale: 1, duration: 0.9, ease: "power3.out" });
  };

  const handleMobileRowTap = (e, idx, isEditable) => {
    if (!isTouch || !isEditable) return;
    e.preventDefault();
    e.stopPropagation();
    setMobileEditIdx(idx === mobileEditIdx ? -1 : idx);
  };

  const handleMobileCommit = (idx, patch) => {
    if (onUpdateItem) onUpdateItem(idx, patch);
    setMobileEditIdx(-1);
  };

  return React.createElement(
    "div",
    { className: "listview-root curved" },
    React.createElement(
      "main",
      { className: "portfolio-container", ref: containerRef },
      React.createElement(
        "ul",
        { className: "project-list", role: "list" },
        items.map((it, idx) => {
          const artist = it.title || "—";
          const album = it.caption || "—";
          const image = it.src || "";
          const isEditable = !it.placeholder && !it.seed && typeof onUpdateItem === "function";
          const isMobileEditing = isTouch && mobileEditIdx === idx;

          const rowClasses = [
            "project-item",
            activeIdx === idx ? "active" : "",
            isEditable && isTouch ? "is-editable" : "",
            isMobileEditing ? "mobile-editing" : "",
          ].filter(Boolean).join(" ");

          return React.createElement(
            "li",
            {
              key: `${it.id || artist}_${idx}`,
              className: rowClasses,
              onMouseEnter: () => onEnterRow(idx, image),
              onContextMenu: (e) => {
                e.preventDefault();
                if (window.deleteFromArchive) {
                  window.showDeleteConfirm(idx, artist, album, window.deleteFromArchive);
                }
              },
              // Touch: tap row to expand edit panel
              onClick: isEditable && isTouch
                ? (e) => handleMobileRowTap(e, idx, isEditable)
                : undefined,
            },
            // Normal display cells (hidden via CSS when mobile-editing)
            React.createElement(EditableCell, {
              value: artist,
              className: "project-data artist",
              editable: isEditable,
              placeholder: "Title",
              onCommit: (val) => onUpdateItem && onUpdateItem(idx, { title: val }),
            }),
            React.createElement(EditableCell, {
              value: album,
              className: "project-data album",
              editable: isEditable,
              placeholder: "Caption",
              onCommit: (val) => onUpdateItem && onUpdateItem(idx, { caption: val }),
            }),
            React.createElement("span", { className: "project-data label" }, " "),
            React.createElement("span", { className: "project-data year" }, new Date().getFullYear()),
            // Mobile edit panel — only rendered (but CSS-hidden) when touch
            isEditable && isTouch && React.createElement(MobileEditPanel, {
              key: `edit_${it.id || idx}`,
              item: it,
              onCommit: (patch) => handleMobileCommit(idx, patch),
              onCancel: () => setMobileEditIdx(-1),
            })
          );
        })
      )
    ),
    React.createElement("div", {
      className: "background-image",
      id: "backgroundImage",
      ref: bgRef,
      role: "img",
      "aria-hidden": "true",
    })
  );
}

  function getCreatedMs(item, idx = 0) {
      if (typeof item?.createdMs === "number") return item.createdMs;
      if (item?.id) {
          const m = String(item.id).match(/^note_(\d+)$/);
          if (m) {
              const n = +m[1];
              if (!Number.isNaN(n)) return n;
          }
      }
      if (item?.ts && /^\d{4}-\d{2}-\d{2} • \d{2}:\d{2}$/.test(item.ts)) {
          const t = Date.parse(item.ts.replace(" • ", "T") + ":00");
          if (!Number.isNaN(t)) return t;
      }
      return idx;
  }
  function loadArchive() {
      try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed.map((it, i) => ({ ...it, createdMs: getCreatedMs(it, i) }));
      } catch {
          return [];
      }
  }
  function saveArchive(arr) {
      try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
      } catch {}
  }
  function App() {
      const WorkgridState = { INTRO: "INTRO", DEFAULT: "DEFAULT", RESET: "RESET" };
      const [wgState, setWgState] = useState(WorkgridState.DEFAULT);
      const [overlayOpen, setOverlayOpen] = useState(!1);
      const [helpOpen, setHelpOpen] = useState(!1);
      const [archive, setArchive] = useState(loadArchive());
      const [seed, setSeed] = useState(SEED);
      const gridCtrl = useRef({ setZoom: (z) => {} });
      const [view, setView] = useState("grid");
      useEffect(() => {
          saveArchive(archive);
      }, [archive]);
      const sortedArchive = useMemo(
          () =>
              [...archive]
                  .map((it, i) => ({ ...it, createdMs: getCreatedMs(it, i) }))
                  .sort((a, b) => b.createdMs - a.createdMs),
          [archive]
      );
      const PLACEHOLDER_START = useMemo(
          () => ({ id: "placeholder_new_start", placeholder: !0, title: "new note", caption: "tap to start" }),
          []
      );
      const PLACEHOLDER_END = useMemo(
          () => ({ id: "placeholder_new_end", placeholder: !0, title: "new note", caption: "tap to start" }),
          []
      );
      const contentItems = useMemo(() => [...sortedArchive, ...seed], [sortedArchive, seed]);
      const combinedItems = useMemo(
          () => [PLACEHOLDER_START, ...contentItems, PLACEHOLDER_END],
          [PLACEHOLDER_START, PLACEHOLDER_END, contentItems]
      );
      useEffect(() => {
          document.documentElement.style.setProperty("--curve-k", String(wgState === WorkgridState.INTRO ? 0 : 1));
      }, [wgState]);
      const hardReset = () => {
          setWgState(WorkgridState.RESET);
          requestAnimationFrame(() => setWgState(WorkgridState.DEFAULT));
      };
      useEffect(() => {
          const onKey = (e) => {
              if (overlayOpen || helpOpen) return;
              if (e.key === "1") setWgState(WorkgridState.INTRO);
              if (e.key === "2") setWgState(WorkgridState.DEFAULT);
              if (e.key === "0") hardReset();
              if (e.key === "n" || e.key === "N") setOverlayOpen(!0);
              if (e.key === "?" || e.key === "h" || e.key === "H") setHelpOpen(!0);
          };
          window.addEventListener("keydown", onKey);
          return () => window.removeEventListener("keydown", onKey);
      }, [overlayOpen, helpOpen]);
      const addNoteToArchive = (note) => setArchive((arr) => [...arr, note]);

      const updateItemInArchive = (listIdx, patch) => {
          if (listIdx >= sortedArchive.length) return;
          const itemToUpdate = sortedArchive[listIdx];
          setArchive((currentArchive) => {
              const newArchive = [...currentArchive];
              const origIdx = currentArchive.findIndex(
                  (it) => it.id === itemToUpdate.id ||
                          (it.title === itemToUpdate.title && it.caption === itemToUpdate.caption)
              );
              if (origIdx !== -1) newArchive[origIdx] = { ...newArchive[origIdx], ...patch };
              return newArchive;
          });
      };


      const deleteFromArchive = (index) => {
          if (index < sortedArchive.length) {
              setArchive((currentArchive) => {
                  const newArchive = [...currentArchive];
                  const itemToDelete = sortedArchive[index];
                  const originalIndex = currentArchive.findIndex(item => 
                      item.id === itemToDelete.id || 
                      (item.artist === itemToDelete.artist && item.album === itemToDelete.album)
                  );
                  
                  if (originalIndex !== -1) {
                      newArchive.splice(originalIndex, 1);
                      return newArchive;
                  }
                  return currentArchive;
              });
          }
      };

      useEffect(() => {
          window.deleteFromArchive = deleteFromArchive;
          return () => {
              delete window.deleteFromArchive;
          };
      }, [deleteFromArchive, sortedArchive]);
      const [zoom, setZoom] = useState(CONFIG.zoomMin + 0.25 * (CONFIG.zoomMax - CONFIG.zoomMin));
      const handleTileClick = (idx, item) => {
          if (item?.placeholder) {
              setOverlayOpen(!0);
          }
      };
      useEffect(() => {
          const gb = document.getElementById("gridBtn"),
              lb = document.getElementById("listBtn");
          const syncBtns = () => {
              gb?.classList.toggle("active", view === "grid");
              lb?.classList.toggle("active", view === "list");
          };
          syncBtns();
          const onGrid = () => {
              setView("grid");
              syncBtns();
          };
          const onList = () => {
              setView("list");
              syncBtns();
          };
          gb?.addEventListener("click", onGrid);
          lb?.addEventListener("click", onList);
          return () => {
              gb?.removeEventListener("click", onGrid);
              lb?.removeEventListener("click", onList);
          };
      }, [view]);
      useEffect(() => {
          const coordsMount = document.getElementById("coordsMount");
          if (!coordsMount) return;
          const onMove = (e) => {
              coordsMount.textContent = `x ${Math.round(e.clientX)} • y ${Math.round(e.clientY)}`;
          };
          window.addEventListener("pointermove", onMove, { passive: !0 });
          return () => window.removeEventListener("pointermove", onMove);
      }, []);
      useEffect(() => {
          if (gridCtrl.current?.setZoom) gridCtrl.current.setZoom(zoom);
          const clamped = Math.max(0, Math.min(1, (zoom - CONFIG.zoomMin) / (CONFIG.zoomMax - CONFIG.zoomMin)));
          const pct = Math.round(clamped * 100);
          document.documentElement.style.setProperty("--zoom-pct", `${pct}%`);
      }, [zoom]);
      return React.createElement(
          React.Fragment,
          null,
          React.createElement(
              "div",
              { className: "canvas-wrap" },
              React.createElement("div", { className: "fallback-grid" }),
              React.createElement(
                  Suspense,
                  { fallback: null },
                  view === "grid"
                      ? React.createElement(GridView, { 
                          workgridState: wgState, 
                          items: combinedItems, 
                          onTileClick: handleTileClick, 
                          controllerRef: gridCtrl, 
                      })
                      : React.createElement(GridView, { 
                          workgridState: wgState, 
                          items: combinedItems, 
                          onTileClick: handleTileClick, 
                          controllerRef: gridCtrl, 
                          isListView: !0 
                      })
              )
          ),
          React.createElement(
              "header",
              { className: "header" },
              React.createElement(
                  "div",
                  { className: "brand", href: "#", "aria-label": "intoview home" },
                  React.createElement("span", null, "Wolfgang's Note")
              ),
              React.createElement(
                  "div",
                  { className: "controls" },
                  React.createElement(
                      "button",
                      {
                          className: "icon-btn",
                          title:
                              wgState === WorkgridState.DEFAULT
                                  ? "Curved (click to go Flat)"
                                  : "Flat (click to go Curved)",
                          onClick: () =>
                              setWgState(
                                  wgState === WorkgridState.DEFAULT ? WorkgridState.INTRO : WorkgridState.DEFAULT
                              ),
                          "aria-label": "Toggle distortion",
                      },
                      React.createElement(
                          "svg",
                          { viewBox: "0 0 24 24", role: "img", "aria-hidden": "true" },
                          React.createElement("rect", {
                              x: "4",
                              y: "4",
                              width: "16",
                              height: "16",
                              rx: wgState === WorkgridState.DEFAULT ? 9 : 2,
                              ry: wgState === WorkgridState.DEFAULT ? 9 : 2,
                              fill: "none",
                              stroke: "currentColor",
                              "stroke-width": "2",
                          })
                      )
                  ),
                  React.createElement(
                      "button",
                      { className: "icon-btn", onClick: hardReset, title: "Reset view", "aria-label": "Reset view" },
                      React.createElement(
                          "svg",
                          { viewBox: "0 0 24 24", role: "img", "aria-hidden": "true" },
                          React.createElement("rect", {
                              x: "4",
                              y: "4",
                              width: "16",
                              height: "16",
                              fill: "none",
                              stroke: "currentColor",
                              "stroke-width": "2",
                          }),
                          React.createElement("circle", {
                              cx: "12",
                              cy: "12",
                              r: "5.5",
                              fill: "none",
                              stroke: "currentColor",
                              "stroke-width": "2",
                          })
                      )
                  ),
                  React.createElement(
                      "button",
                      {
                          className: "icon-btn",
                          "aria-label": "Info / Controls",
                          onClick: () => setHelpOpen(!0),
                          title: "Help / Controls",
                      },
                      React.createElement(
                          "svg",
                          { viewBox: "0 0 24 24", role: "img", "aria-hidden": "true" },
                          React.createElement("circle", {
                              cx: "12",
                              cy: "12",
                              r: "10",
                              fill: "none",
                              stroke: "currentColor",
                              "stroke-width": "2",
                          }),
                          React.createElement("line", {
                              x1: "12",
                              y1: "16",
                              x2: "12",
                              y2: "12",
                              stroke: "currentColor",
                              "stroke-width": "2",
                              "stroke-linecap": "round",
                          }),
                          React.createElement("circle", { cx: "12", cy: "8", r: "1.2", fill: "currentColor" })
                      )
                  )
              )
          ),
          view === "list" && React.createElement(ListView, { items: contentItems, onUpdateItem: updateItemInArchive }),
          React.createElement(HelpOverlay, { open: helpOpen, onClose: () => setHelpOpen(!1) }),
          React.createElement(OverlayFlow, {
              open: overlayOpen,
              onClose: () => setOverlayOpen(!1),
              onAddToArchive: addNoteToArchive,
          }),
          React.createElement("div", { className: "edge-blur" }),
          React.createElement("div", { className: "vignette" }),
          React.createElement(ZoomPresets, { zoom, onSetZoom: (z) => gridCtrl.current?.setZoom?.(z) }),
          React.createElement(
              "div",
              { className: "fab-wrap" },
              React.createElement(
                  "button",
                  {
                      className: "fab",
                      onClick: () => setOverlayOpen(!0),
                      title: "New note",
                      "aria-label": "intoview:note",
                  },
                  React.createElement(
                      "svg",
                      { viewBox: "0 0 100 100", "aria-hidden": "true" },
                      React.createElement(
                          "defs",
                          null,
                          React.createElement(
                              "linearGradient",
                              { id: "cubeTop", x1: "0", x2: "1", y1: "0", y2: "1" },
                              React.createElement("stop", { offset: "0", "stop-color": "#fff", "stop-opacity": "1" }),
                              React.createElement("stop", {
                                  offset: "1",
                                  "stop-color": "#dcdcdc",
                                  "stop-opacity": "1",
                              })
                          ),
                          React.createElement(
                              "linearGradient",
                              { id: "cubeSide", x1: "0", x2: "1", y1: "0", y2: "1" },
                              React.createElement("stop", { offset: "0", "stop-color": "#e8e8e8" }),
                              React.createElement("stop", { offset: "1", "stop-color": "#bdbdbd" })
                          ),
                          React.createElement(
                              "linearGradient",
                              { id: "cubeDark", x1: "0", x2: "1", y1: "0", y2: "1" },
                              React.createElement("stop", { offset: "0", "stop-color": "#8a8a8a" }),
                              React.createElement("stop", { offset: "1", "stop-color": "#4b4b4b" })
                          ),
                          React.createElement(
                              "filter",
                              { id: "cubeGlow", x: "-50%", y: "-50%", width: "200%", height: "200%" },
                              React.createElement("feDropShadow", {
                                  dx: "0",
                                  dy: "6",
                                  stdDeviation: "6",
                                  "flood-color": "#000",
                                  "flood-opacity": ".45",
                              })
                          )
                      ),
                      React.createElement(
                          "g",
                          { filter: "url(#cubeGlow)" },
                          React.createElement("polygon", {
                              fill: "url(#cubeTop)",
                              points: "50,14 80,30 50,46 20,30",
                          }),
                          React.createElement("polygon", {
                              fill: "url(#cubeSide)",
                              points: "80,30 80,66 50,82 50,46",
                          }),
                          React.createElement("polygon", {
                              fill: "url(#cubeDark)",
                              points: "50,46 50,82 20,66 20,30",
                          })
                      )
                  ),
                  React.createElement("span", { className: "fab-text" }, "New Note")
              )
          )
      );
  }
  const root = createRoot(document.getElementById("root"));
  root.render(React.createElement(App));
  (function initGooeyCursor() {
      const TAIL_LENGTH = 12;
      const host = document.getElementById("cursor");
      if (!host) return;
      for (let i = 0; i < TAIL_LENGTH; i++) {
          const d = document.createElement("div");
          d.className = "cursor-circle";
          host.appendChild(d);
      }
      const circles = Array.from(host.querySelectorAll(".cursor-circle"));
      let mouseX = innerWidth / 2,
          mouseY = innerHeight / 2;
      let history = Array(TAIL_LENGTH)
          .fill(0)
          .map(() => ({ x: mouseX, y: mouseY }));
      const onMove = (e) => {
          mouseX = e.clientX;
          mouseY = e.clientY;
      };
      window.addEventListener("pointermove", onMove, { passive: !0 });
      function tick() {
          history.shift();
          history.push({ x: mouseX, y: mouseY });
          for (let i = 0; i < TAIL_LENGTH; i++) {
              const cur = history[i];
              const next = history[i + 1] || history[TAIL_LENGTH - 1];
              cur.x += (next.x - cur.x) * 0.35;
              cur.y += (next.y - cur.y) * 0.35;
              const s = Math.max(0.22, i / TAIL_LENGTH);
              circles[i].style.transform = `translate3d(${cur.x}px, ${cur.y}px, 0) scale(${s})`;
          }
          requestAnimationFrame(tick);
      }
      tick();
  })();
</script>


<script>
  const hudVersion = document.querySelector('.hud-left');
  const readmeOverlay = document.getElementById('readmeOverlay');
  const readmeClose = document.getElementById('readmeClose');

  hudVersion.style.cursor = 'pointer';
  hudVersion.style.pointerEvents = 'auto';

  hudVersion.addEventListener('click', () => {
    readmeOverlay.classList.add('open');
    document.body.classList.add('no-scroll');
  });

  readmeClose.addEventListener('click', () => {
    readmeOverlay.classList.remove('open');
    document.body.classList.remove('no-scroll');
  });

  const deleteConfirmOverlay = document.getElementById('deleteConfirmOverlay');
  const cancelDeleteBtn = document.getElementById('cancelDelete');
  const confirmDeleteBtn = document.getElementById('confirmDelete');
  
  let pendingDeleteIndex = null;
  let pendingDeleteCallback = null;

  window.showDeleteConfirm = function(index, artist, album, deleteCallback) {
    pendingDeleteIndex = index;
    pendingDeleteCallback = deleteCallback;
    deleteConfirmOverlay.classList.add('open');
    document.body.classList.add('no-scroll');
    
    const dialogText = deleteConfirmOverlay.querySelector('p');
    dialogText.textContent = `Are you sure you want to delete "${artist} - ${album}"? This action cannot be undone.`;
  };

  cancelDeleteBtn.addEventListener('click', () => {
    deleteConfirmOverlay.classList.remove('open');
    document.body.classList.remove('no-scroll');
    pendingDeleteIndex = null;
    pendingDeleteCallback = null;
  });

  confirmDeleteBtn.addEventListener('click', () => {
    if (pendingDeleteIndex !== null && pendingDeleteCallback) {
      pendingDeleteCallback(pendingDeleteIndex);
    }
    
    deleteConfirmOverlay.classList.remove('open');
    document.body.classList.remove('no-scroll');
    pendingDeleteIndex = null;
    pendingDeleteCallback = null;
  });
</script>

<script>
// ═══════════════════════════════════════════════════════════
//  CINEMATIC PAGE LOADER — full-viewport carousel
// ═══════════════════════════════════════════════════════════
(function () {
    // Pull image URLs from SEED (defined earlier in the script)
    // We pick a random selection of ~16 images to cycle through
    function getLoaderImages() {
        if (typeof SEED === 'undefined' || !Array.isArray(SEED)) return [];
        const shuffled = [...SEED].sort(() => Math.random() - 0.5);
        return shuffled.slice(0, 18).map(s => ({ src: s.src, title: s.title }));
    }

    const loader    = document.getElementById('page-loader');
    const caption   = document.getElementById('pl-caption');
    const counter   = document.getElementById('pl-counter');
    const progress  = document.getElementById('pl-progress');

    if (!loader) return;

    const images = getLoaderImages();
    const total  = images.length;
    if (total === 0) { loader.classList.add('fade-out'); return; }

    // ── Create slide elements ──────────────────────────────
    const slides = images.map((img, i) => {
        const el = document.createElement('div');
        el.className = 'pl-slide';
        el.style.backgroundImage = `url(${img.src})`;
        el.style.zIndex = 1;
        loader.insertBefore(el, loader.querySelector('.pl-vignette'));
        return el;
    });

    let current   = 0;
    let done      = false;
    let interval  = null;
    const SPEED   = 260; // ms per slide

    function showSlide(idx) {
        slides.forEach((s, i) => s.classList.toggle('pl-active', i === idx));
        const img = images[idx];
        if (caption) caption.textContent = img.title.replace(/([a-z])([A-Z])/g, '$1 $2');
        if (counter) counter.textContent = (idx + 1).toString().padStart(2, '0') + ' / ' + total.toString().padStart(2, '0');
        if (progress) progress.style.width = ((idx + 1) / total * 100) + '%';
    }

    function tick() {
        if (done) return;
        current = (current + 1) % total;
        showSlide(current);
    }

    // Show first slide immediately
    showSlide(0);
    interval = setInterval(tick, SPEED);

    // ── Dismiss when grid is loaded ────────────────────────
    function dismiss() {
        if (done) return;
        done = true;
        clearInterval(interval);
        // Fill progress bar to 100%
        if (progress) progress.style.width = '100%';
        // Short hold so last frame feels intentional, then fade
        setTimeout(() => {
            loader.classList.add('fade-out');
            setTimeout(() => { loader.classList.add('hidden'); }, 950);
        }, 380);
    }

    // Listen for the app's own loader removal signal
    window.addEventListener('load', () => setTimeout(dismiss, 600));

    // Also watch the legacy #loader for its active class being removed
    // (the React app does: loader.classList.remove('active'))
    const legacyLoader = document.getElementById('loader');
    if (legacyLoader) {
        const obs = new MutationObserver(() => {
            if (!legacyLoader.classList.contains('active')) {
                obs.disconnect();
                dismiss();
            }
        });
        obs.observe(legacyLoader, { attributes: true, attributeFilter: ['class'] });
    }

    // Safety: dismiss after 8s no matter what
    setTimeout(dismiss, 8000);
})();
</script>
</body>
</html>
